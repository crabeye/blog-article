{
    "version": "https://jsonfeed.org/version/1",
    "title": "Bill Lee's Blog",
    "subtitle": "码农的马，谢谢的蟹",
    "icon": "https://blog.liq2.com/images/favicon.ico",
    "description": "好记性不如烂笔头",
    "home_page_url": "https://blog.liq2.com",
    "items": [
        {
            "id": "https://blog.liq2.com/article/8f21b90e",
            "url": "https://blog.liq2.com/article/8f21b90e",
            "title": "图数据库Neo4J学习总结（一）",
            "date_published": "2022-08-19T06:46:13.000Z",
            "content_html": "<h2 id=\"一-基础概念\"><a class=\"anchor\" href=\"#一-基础概念\">#</a> 一、基础概念</h2>\n<h3 id=\"图数据库理论基础\"><a class=\"anchor\" href=\"#图数据库理论基础\">#</a> 图数据库理论基础</h3>\n<p>图形数据库（Graph Database）的解释说明：</p>\n<blockquote>\n<p>在计算机科学中，图数据库（英语：graph database，GDB）是一个使用图结构进行语义查询的数据库，它使用节点、边和属性来表示和存储数据。该系统的关键概念是图，它直接将存储中的数据项，与数据节点和节点间表示关系的边的集合相关联。这些关系允许直接将存储区中的数据链接在一起，并且在许多情况下，可以通过一个操作进行检索。图数据库将数据之间的关系作为优先级。查询图数据库中的关系很快，因为它们永久存储在数据库本身中。可以使用图数据库直观地显示关系，使其对于高度互连的数据非常有用。</p>\n<p>** 图数据库是一种非关系型数据库，以解决现有关系数据库的局限性。** 图模型明确地列出了数据节点之间的依赖关系，而关系模型和其他 NoSQL 数据库模型则通过隐式连接来链接数据。图数据库从设计上，就是可以简单快速地检索难以在关系系统中建模的复杂层次结构的。图数据库与 20 世纪 70 年代的网络模型数据库相似，它们都表示一般的图，但是网络模型数据库在较低的抽象层次上运行，并且不能轻松遍历一系列边。</p>\n<p>图数据库的底层存储机制可能各有不同。有些依赖于关系引擎并将图数据 “存储” 到表中（虽然表是一个逻辑元素，但是这种方法在图数据库、图数据库管理系统和实际存储数据的物理设备之间施加了另一层抽象）。另一些则使用键值存储或文件导向的数据库进行存储，使它们具有固有的 NoSQL 结构。大多数基于非关系存储引擎的图数据库还添加了标记或属性的概念，这些标记或属性本质上是具有指向另一个文档的指针的关系。这样就可以对数据元素进行分类，以便于集中检索。</p>\n<p>从图数据库中检索数据需要 SQL 之外的查询语言，SQL 是为了处理关系系统中的数据而设计的，因此无法 “优雅地” 处理遍历图。截至 2017 年，没有一个像 SQL 那样通用的图查询语言，通常都是仅限与一个产品的。不过，已经有一些标准化的工作，使得 Gremlin、SPARQL 和 Cypher 成为了多供应商查询语言。除了具有查询语言接口外，还可以通过应用程序接口（API）访问一些图数据库。</p>\n<p>图数据库与图计算引擎不同。图数据库是转换关系 OLTP 数据库的技术。而图计算引擎在 OLAP 中用于批量分析。由于主要技术公司在使用专有图数据库方面的成功以及开源图数据库的引入，图数据库在 2000 年代引起了相当大的关注。</p>\n</blockquote>\n<h4 id=\"主要组成\"><a class=\"anchor\" href=\"#主要组成\">#</a> 主要组成</h4>\n<ul>\n<li>\n<p>节点</p>\n<p>图数据库数据存储的主要组成部分，由节点属性和节点标签组成</p>\n<ul>\n<li>节点属性  描述节点特征和状态等，类似于关系型数据库的表属性，可以存在多个；</li>\n<li>节点标签  一个节点可以有多个标签，标签有类似关系型数据库表名的概念；</li>\n</ul>\n</li>\n<li>\n<p>关系</p>\n<p>关系用于描述两个节点的关系，有方向，所以一般包含起始属性 start 和结束属性 end</p>\n<ul>\n<li>\n<p>关系属性 属性的一些相关描述信息</p>\n</li>\n<li>\n<p>关系标签 用于标注关系的类型</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"为什么使用图数据库\"><a class=\"anchor\" href=\"#为什么使用图数据库\">#</a> 为什么使用图数据库</h3>\n<p>与传统关系型数据库相比，图数据库有以下优势：</p>\n<ul>\n<li>\n<p>由于存储了节点和节点之间的关系，解决常规数据库对多层查询效率低下的问题；</p>\n</li>\n<li>\n<p>可以很自然的表达现实世界中的实体及其关联关系（对应图的顶点及边）；</p>\n</li>\n<li>\n<p>灵活的数据模型可以适应不断变化的业务需求；</p>\n</li>\n<li>\n<p>灵活的图查询语言，轻松实现复杂关系网络的分析；</p>\n</li>\n<li>\n<p>关系型数据库在数据规模庞大时很难做多层关联关系分析（Join 操作往往消耗过长时间而失败），图数据库则天然把关联数据连接在一起，无需耗时耗内存的 Join 操作，可以保持常数级时间复杂度。</p>\n</li>\n<li>\n<p>使用图（或者网）的方式来表达现实世界的关系很直接、自然，易于建模。比如某人喜欢看某电影，就可以建立一条边连接这个人和这部电影，这条边就叫做 “喜欢” 边，同时这个人还可以有其它边，比如 “朋友” 边、“同学” 边等，同样这个电影也可以有其它边，比如 “导演” 边、“主演” 边等，这样就构建了自然的关系网。</p>\n</li>\n<li>\n<p>图数据库可以很高效的插入大量数据。图数据库面向的应用领域数据量可能都比较大，比如知识图谱、社交关系、风控关系等，总数据量级别一般在亿或十亿以上，有的甚至达到百亿边。mysql 不做分表分库的情况下插入百万数据基本就慢到不行，图数据库基本能胜任亿级以上的数据，比如 neo4j、titan (janus)、hugegraph 等图数据库，持续插入十亿级的数据基本还能保持在一个较高的速度。</p>\n</li>\n<li>\n<p>图数据库可以很高效的查询关联数据。传统关系型数据库不擅长做关联查询，特别是多层关联（比如查我的好友的好友有哪些人），因为一般来说都需要做表连接，表连接是一个很昂贵的操作，涉及到大量的 IO 操作及内存消耗。</p>\n</li>\n<li>\n<p>图数据库对关联查询一般都进行针对性的优化，比如存储模型上、数据结构、查询算法等，防止局部数据的查询引发全部数据的读取。图数据库提供了针对图检索的查询语言，比如 Gremlin、Cypher 等图数据库语言。图查询语言大大方便了关联分析业务的持续开发，传统方案在需求变更时往往要修改数据存储模型、修改复杂的查询脚本，图数据库已经把业务表达抽象好了，比如上面的 2 层好友查询，Gremlin 实现为 g.V (me).out ('friend').out ('friend')，如果需要改为 2 层同学查询，那调整一下把好友换为同学即可 g.V (me).out ('classmate').out ('classmate')。</p>\n</li>\n<li>\n<p>图数据库提供了专业的分析算法、工具。比如 ShortestPath、PageRank、PersonalRank、Louvain 等等，不少图数据库还提供了数据批量导入工具，提供了可视化的图显示界面，使得数据的分析结果更加直观展示出来。</p>\n</li>\n</ul>\n<h3 id=\"图数据库的适用领域\"><a class=\"anchor\" href=\"#图数据库的适用领域\">#</a> 图数据库的适用领域</h3>\n<ul>\n<li>\n<h4 id=\"社会学研究\"><a class=\"anchor\" href=\"#社会学研究\">#</a> 社会学研究</h4>\n<p>很早以前，人们就已经认知到人类相互作用的方式其实很容易通过网络方式来描述。每 天人与人打交道，每天都在互相影响，每天都在交换想法。这些相互作用会通过他们所处的 社会环境产生连锁效应。将这些相互作用用图来进行建模，能更好地理解全球人口结构、政 治活动，以及特定群体对特定产品的商业价值等。随着在线社交网络的出现，这种以图为基 础的社会认知方法已经有了一个全新的方向。像 Google、Facebook、Twitter、LinkedIn 等许 多公司都已经做出了非常实际的努力，即基于图的应用系统，这些系统以客户或用户为目 标，并从根本上改变了我们的日常生活。</p>\n</li>\n<li>\n<h4 id=\"生物学研究\"><a class=\"anchor\" href=\"#生物学研究\">#</a> 生物学研究</h4>\n<p>常用的营销口号：图无处不在。这实际上是用一种非常真实而有趣的方式来刻画现实世 界。同样，在生物学领域，研究人员很早就知道，生物成分（蛋白质、分子、基因等）以及 它们的相互作用可以用图来精确建模和描述，这样将带来诸多现实好处。在代谢途径中 （metabolic pathways），图有助于了解人体不同部位的 相互作用。在宏蛋白质组学（metaproteomics，从自然环境中提取蛋白质样本的研究）中，研 究人员分析了不同种类蛋白质之间是如何相互作用的，以利于更好地控制化合或生物过程。</p>\n</li>\n<li>\n<h4 id=\"计算机科学研究\"><a class=\"anchor\" href=\"#计算机科学研究\">#</a> 计算机科学研究</h4>\n<p>早期的一些计算机是用图来设计的。图计算引擎早在 19 世纪晚期就用于解决铁路调度问 题，自那以后，图在计算机科学中得到了广泛使用，现今遍及芯片设计、网络管理、推荐系 统、UML 建模、算法中生成和依赖分析等。</p>\n<p>还有一个有趣的案例是采用路径发现算法，软硬件工程师可以不间断地分析系统设计中 的变化对系统其他部分带来的影响。如果源代码的一部分做了更改，例如，一个特定对象 （object）被重命名，依赖分析算法可以轻松地遍历整个系统图，以找出其他受影响的类 （class）。</p>\n</li>\n<li>\n<h4 id=\"流量问题\"><a class=\"anchor\" href=\"#流量问题\">#</a> 流量问题</h4>\n<p>流量问题（flow problems），也称为最大流问题（maximum flow problems），是图论的 又一个非常有趣的应用领域。事实上，从大的方面来讲它是一个优化问题，试图在整个流网 络中找到最佳路径。流网络图中，节点（顶点）通过关系（边）相互连接，关系（边）代表 特定容量。例如，在电信网络、天然气网络、航空网络、包裹递送网络等诸多领域案例中， 通常在图模型的基础上结合复杂的算法。</p>\n</li>\n<li>\n<h4 id=\"路径问题\"><a class=\"anchor\" href=\"#路径问题\">#</a> 路径问题</h4>\n<p>比如十八世纪欧拉解决的哥尼斯堡七桥问题，实际上是一个路径规划或寻径问题 （route planning/pathfinding problem）。今天，许多图应用程序充分利用图及其算法的非凡能 力，而不再是通过尝试或错误排查来计算出网络上两个节点之间的最优路径。</p>\n</li>\n<li>\n<h4 id=\"网页搜索\"><a class=\"anchor\" href=\"#网页搜索\">#</a> 网页搜索</h4>\n<p>何一本涉及图或图论的图书，哪怕是最优秀的，都无可避免地要提到世上最强大、使 用最广泛的图算法 ——PageRank。PageRank 最初是一个图算法，是 1996 年由谷歌创始人拉 里・佩奇在斯坦福大学发明的，用以获得更好的网页搜索结果。对于那些还记得互联网早期 的搜索工具（例如 Lycos、AltaVista 等）的人们而言，它给终端用户带来了一个真正革命性 的网页搜索方式。</p>\n</li>\n</ul>\n<h3 id=\"常见的图数据库\"><a class=\"anchor\" href=\"#常见的图数据库\">#</a> 常见的图数据库</h3>\n<table>\n<thead>\n<tr>\n<th>数据库名称</th>\n<th>Neo4J</th>\n<th>titan</th>\n<th>arangodb</th>\n<th>crientdb</th>\n<th>gun</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>语言</td>\n<td>JAVA</td>\n<td>JAVA</td>\n<td>C++</td>\n<td>JAVA</td>\n<td>JS</td>\n</tr>\n<tr>\n<td>更新活跃度</td>\n<td>高</td>\n<td>近一年无更新</td>\n<td>高</td>\n<td>比较新</td>\n<td>比较新</td>\n</tr>\n<tr>\n<td>个人使用</td>\n<td>GPLv3</td>\n<td>Apache-2.0</td>\n<td>Apache-2.0</td>\n<td>Apache-2.0</td>\n<td>Zlib/MIT/Apache-2.0</td>\n</tr>\n<tr>\n<td>商业使用</td>\n<td>开源版本 GPLv3&lt;br /&gt; 企业版收费</td>\n<td>同上</td>\n<td>同上</td>\n<td>同上</td>\n<td>同上</td>\n</tr>\n<tr>\n<td>查询语言</td>\n<td>Cypher</td>\n<td>Gremlin</td>\n<td>AQL</td>\n<td>SQL</td>\n<td>JS</td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "数据库",
                "非关系型",
                "Neo4J",
                "图数据库",
                "Neo4J"
            ]
        },
        {
            "id": "https://blog.liq2.com/article/dafad32e",
            "url": "https://blog.liq2.com/article/dafad32e",
            "title": "几道笔试题目",
            "date_published": "2022-07-31T06:51:00.000Z",
            "content_html": "<p>匆匆，七月已了；</p>\n<p>记录几道题目，试试效果。</p>\n<h1 id=\"1\"><a class=\"anchor\" href=\"#1\">#</a> #1</h1>\n<pre><code>给出原文字符串str，通过对字符串的每个字母进行改变来实现加密，加密方式是在每一个字母str[i]偏移特定数组元素a[i]的量。数组a的前三位已经赋值：a[0]=1,a[1]=2,a[2]=4,当i&gt;=3时，数组元素a[i]=a[i-1]+a[i-2]+a[i-3]。\n例如：原文abcde加密后bdgkr，其中偏移量分别是1，2，4，7，13。\n输入描述：第一行是整数n，表示n组测试数据。每组数据包含一行，原文str(只含有小写字母，长度大于0小于50)。\n输出描述：每组测试数据输出一行，表示密文。\n</code></pre>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">BufferedReader</span> br <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> move <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">String</span> str <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>str <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">int</span> count <span class=\"token operator\">=</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">int</span> temp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">char</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> cArr<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">StringBuilder</span> sb <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> count<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                cArr <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toCharArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> x <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> x <span class=\"token operator\">&lt;</span> cArr<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> x<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        temp <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>cArr<span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> move<span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">97</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">26</span> <span class=\"token operator\">+</span> <span class=\"token number\">97</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                        temp <span class=\"token operator\">=</span> move<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> move<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> move<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                        move<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> move<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                        move<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> move<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                        move<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> temp<span class=\"token operator\">%</span><span class=\"token number\">26</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 特别注意这里要取模，不然容易造成长字符串导致数字过大而减低通过率</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                        temp <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>cArr<span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> temp<span class=\"token operator\">%</span><span class=\"token number\">26</span> <span class=\"token operator\">-</span> <span class=\"token number\">97</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">26</span> <span class=\"token operator\">+</span> <span class=\"token number\">97</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    cArr<span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                sb<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>cArr<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                move<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                move<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                move<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>sb<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> sb<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"2\"><a class=\"anchor\" href=\"#2\">#</a> #2</h1>\n<pre><code>将字符串分割成一些子串，使每个子串的ASClI码值的和均为水仙花数（水仙花数就是各位的立方之和等于本身的数）。\n1、若分割不成功，则返回0\n2、若分割成功且分割结果不唯一，则返回-1\n3、若分割成功且分割结果唯一，则返回分割后子串的数目\n输入：abc\n输出：0（说明：分割不成功）\n输入：f3@d5a8\n输出：-1（说明：分割成功且结果不唯一。结果1：f3和@d5a8，结果2：f3@d5和a8）\n输入：AXdddF\n输出：2（说明：分割成功且结果唯一：AX和dddF）\n字符串最大长度为200\n</code></pre>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">// 接收控制台数据</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">Scanner</span> scanner <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Scanner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> scanner<span class=\"token punctuation\">.</span><span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        scanner<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 存放分割子串的末端索引的链表</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 如 f3@d5a8 可分割为 f3 和 @d5a8 两个水仙花字符串，则链表中存放 2 和 7</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">// 当前分割子串的起始索引</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">int</span> p <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// 当前状态 (1: 已成功分割过一次 0: 还未分割成功过 -1: 分割结果不唯一)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">byte</span> status <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// 记录第一次分割成功的子串数</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">//q 为当前分割子串的末端索引</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> q <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> q <span class=\"token operator\">&lt;=</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> q<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>q <span class=\"token operator\">==</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token comment\">// 如果分割成功，并且之前已成功分割过一次，状态置为 - 1 并跳出循环</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isSXHStr</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">,</span> q<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> status <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                    status <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token comment\">// 如果分割成功，并且之前还未分割成功过，状态置为 1, 继续往下走尝试其他分割方法</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isSXHStr</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">,</span> q<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> status <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                    status <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    num <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token comment\">// 如果链表为空，说明已遍历完所有分割方法，跳出循环</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token comment\">// 改变 p 和 q 以尝试其他分割方法</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                q <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">getLast</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                list<span class=\"token punctuation\">.</span><span class=\"token function\">removeLast</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                p <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token operator\">:</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">getLast</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isSXHStr</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">,</span> q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                list<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                p <span class=\"token operator\">=</span> q<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>status <span class=\"token operator\">==</span> <span class=\"token number\">1</span> <span class=\"token operator\">?</span> num <span class=\"token operator\">:</span> status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token comment\">// 判断分割子串是否为水仙花字符串</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isSXHStr</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> s<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> p<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> q<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token keyword\">int</span> sum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> p<span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> q<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>            <span class=\"token keyword\">char</span> c <span class=\"token operator\">=</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            sum <span class=\"token operator\">+=</span> c<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">isSXHNum</span><span class=\"token punctuation\">(</span>sum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token comment\">// 判断整数是否为水仙花数</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isSXHNum</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> num<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token class-name\">String</span> s <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token keyword\">int</span> sum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> s<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>            <span class=\"token keyword\">int</span> digit <span class=\"token operator\">=</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>            sum <span class=\"token operator\">+=</span> digit <span class=\"token operator\">*</span> digit <span class=\"token operator\">*</span> digit<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>        <span class=\"token keyword\">return</span> sum <span class=\"token operator\">==</span> num<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"3\"><a class=\"anchor\" href=\"#3\">#</a> #3</h1>\n<pre><code> 【跳格子】\n 地上共有N个格子，你需要跳完地上所有的格子，但是格子间是有强依赖关系的，跳完前一个格子后，后续的格子才会被开启，格子间的依赖关系由多组steps数组给出，steps[0]表示前一个格子，steps[1]表示steps[0]可以开启的格子:\n 比如[0,1]表示从跳完第0个格子以后第1个格子就开启了，比如[2,1]，[2,3]表示跳完第2个格子后第1个格子和第3个格子就被开启了。\n 请你计算是否能由给出的steps数组跳完所有的格子，如果可以输出yes，否则输出no。\n 说明：\n 1.你可以从一个格子跳到任意一个开启的格子\n 2.没有前置依赖条件的格子默认就是开启的\n 3.如果总数是N，则所有的格子编号为[0,1,2,3…N-1]连续的数组\n 输入描述:\n 输入一个整数N表示总共有多少个格子，接着输入多组二维数组steps表示所有格子之间的依赖关系。\n 输出描述:\n 如果能按照steps给定的依赖顺序跳完所有的格子输出yes，\n 否则输出no。\n</code></pre>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Main</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">BufferedReader</span> br <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BufferedReader</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InputStreamReader</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>in<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">String</span> str <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>str <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">int</span> n <span class=\"token operator\">=</span> <span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token class-name\">List</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> conditions <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>str <span class=\"token operator\">=</span> br<span class=\"token punctuation\">.</span><span class=\"token function\">readLine</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!=</span><span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>str<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> line <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                conditions<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> path<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token class-name\">String</span> result <span class=\"token operator\">=</span> <span class=\"token string\">\"yes\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span>conditions<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                path <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">canPass</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> conditions<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    result <span class=\"token operator\">=</span> <span class=\"token string\">\"no\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">nextBoolean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token string\">\"yes\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"no\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">canPass</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> idx<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> conditions<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> path<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        path<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>conditions<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span>conditions<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token comment\">// 如果路徑上面已經存在要查詢的關聯的值 說明有循環依賴  返回 false</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>conditions<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">==</span>conditions<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> x <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> x <span class=\"token operator\">&lt;</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> x<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>conditions<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token comment\">// 如果存在進一步的依賴 繼續驗證</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>conditions<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> conditions<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                <span class=\"token keyword\">return</span> <span class=\"token function\">canPass</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> conditions<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "后端",
                "Java",
                "日积月累",
                "面试",
                "Java基础",
                "数据结构",
                "算法"
            ]
        },
        {
            "id": "https://blog.liq2.com/article/ff29002e",
            "url": "https://blog.liq2.com/article/ff29002e",
            "title": "解决hexo-shoka主题的流程图mermaid不能正常显示问题",
            "date_published": "2022-06-29T04:07:21.000Z",
            "content_html": "<p>前几天总结了一下分布式事务的文字，由于写了一些解决方案的执行原理，用到了状态图，开开心心的在 Typora 上面显示的好好的，结果已发布到 hexo 博客，直接<span class=\"red\">显示不出来</span>！！！🕳</p>\n<h2 id=\"解决过程\"><a class=\"anchor\" href=\"#解决过程\">#</a> 解决过程</h2>\n<ul class=\"task-list\">\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" id=\"cbx_0\" disabled=\"true\" /><label for=\"cbx_0\"> 开始以为是没有正确安装 mermaind 依赖，一顿安装命令安装 <code>npm i markdown-it-mermaid --save --legacy-peer-deps</code>  结果还是不行；</label></p>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" id=\"cbx_1\" disabled=\"true\" /><label for=\"cbx_1\"> 又是怀疑配置不对，在_config.yml 上面，在主题官方操作文档也没有说明的情况下，添加各种猜测的配置测试还是没有结果；</label></p>\n</li>\n</ul>\n<p>然后比较官方网站的流程图页面的的 html 源码，发现流程图是由一个个 svg 标签，而自己的页面却没有，而直接拷贝这段 svg 到 public 文件夹下面的文件的 html 文件里面是可以正常显示的，这说明官方文档说的要在显示流程图的 html 文件中添加 mermaid 的 css 依赖是有正常加载的，那么只有一个可能就是由 markdown 构建 html 文件的时候除了问题！</p>\n<p>各种找啊找，终于找到一个目录在 <span class=\"rainbow\">node_modules\\hexo-renderer-multi-markdown-it\\lib\\renderer\\markdown-it-mermaid</span> 里面的 55-69 行的中间打上一个 console.log</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"><span>markdown-it-mermaid</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>md<span class=\"token punctuation\">.</span>renderer<span class=\"token punctuation\">.</span>rules<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">fence</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tokens<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">,</span> self</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> tokens<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">const</span> code <span class=\"token operator\">=</span> token<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr class=\"marked\"><td data-num=\"5\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span>info <span class=\"token operator\">+</span> <span class=\"token string\">'&lt;------'</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span>info <span class=\"token operator\">===</span> <span class=\"token string\">'mermaid'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span>info <span class=\"token operator\">===</span> <span class=\"token string\">'mermaid'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">var</span> firstLine <span class=\"token operator\">=</span> code<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\n</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>firstLine<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^graph (?:TB|BT|RL|LR|TD);?$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                firstLine <span class=\"token operator\">=</span> <span class=\"token string\">' graph'</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                firstLine <span class=\"token operator\">=</span> <span class=\"token string\">''</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token function\">mermaidChart</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">,</span> firstLine<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">defaultRenderer</span><span class=\"token punctuation\">(</span>tokens<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>发现如果使用如下的代码块注释的时候，根本进入不到上面的调试代码</p>\n<figure class=\"highlight raw\"><figcaption data-lang=\"\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>&#96;&#96;&#96;mermaid</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>some content here</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>&#96;&#96;&#96;</pre></td></tr></table></figure><p>开始怀疑人生的时候，在 <ins class=\"dot\">npx hexo server</ins> 打开的情况下，一个不小心将上面的的 mermaid 后面加上了一个 2，形如</p>\n<figure class=\"highlight raw\"><figcaption data-lang=\"\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>&#96;&#96;&#96;mermaid2</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>some content here</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>&#96;&#96;&#96;</pre></td></tr></table></figure><p>结果控制台输出了</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mermaid<span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>&lt;</span>------false</pre></td></tr></table></figure><p>😓😓😓😓😓😓😓😓😓😓😓😓原来 mermaid 没有被识别为 token?? 但是如果改成 mermaid2 的话，Typora 又识别不了啊</p>\n<h2 id=\"最后解决方案\"><a class=\"anchor\" href=\"#最后解决方案\">#</a> 最后解决方案</h2>\n<p>修改 <code>node_modules\\hexo-renderer-multi-markdown-it\\lib\\renderer\\markdown-it-mermaid</code>  文件的第 59 行的判断 <code>if (token.info === 'Mermaid') &#123;</code> 这样<mark>在 Typora 编辑的时候也注意要第一个字母大写</mark>了😹, 勉强的解决方案</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>md<span class=\"token punctuation\">.</span>renderer<span class=\"token punctuation\">.</span>rules<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">fence</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tokens<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">,</span> self</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> tokens<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">const</span> code <span class=\"token operator\">=</span> token<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span>info <span class=\"token operator\">+</span> <span class=\"token string\">'&lt;------'</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span>info <span class=\"token operator\">===</span> <span class=\"token string\">'Mermaid'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr class=\"marked\"><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">.</span>info <span class=\"token operator\">===</span> <span class=\"token string\">'Mermaid'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">var</span> firstLine <span class=\"token operator\">=</span> code<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\n</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>firstLine<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^graph (?:TB|BT|RL|LR|TD);?$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                firstLine <span class=\"token operator\">=</span> <span class=\"token string\">' graph'</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                firstLine <span class=\"token operator\">=</span> <span class=\"token string\">''</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token function\">mermaidChart</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">,</span> firstLine<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">defaultRenderer</span><span class=\"token punctuation\">(</span>tokens<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">,</span> env<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>有遇到这个问题并且完美解决的留言教我啊🙏🙏</p>\n",
            "tags": [
                "前端",
                "工具",
                "Hexo",
                "Hexo",
                "工具使用"
            ]
        },
        {
            "id": "https://blog.liq2.com/article/62ceeeec",
            "url": "https://blog.liq2.com/article/62ceeeec",
            "title": "分布式事务解决方案",
            "date_published": "2022-06-22T01:07:23.000Z",
            "content_html": "<p>事务，大多时候我们是说在单体应用情况下，把多个操作整体执行的能力，分布式事务，就是在多个应用甚至多个数据源的情况下，保证操作的事务特性，在开始之前先回顾一下事务的相关基础知识</p>\n<h1 id=\"一-基础概念\"><a class=\"anchor\" href=\"#一-基础概念\">#</a> 一、基础概念</h1>\n<p>举一个例子，我们有一个网上商城平台，用户下单购买商品，商品的库存减少，同时产生一条订单记录，订单上这个商品的数量就是商品库存的数量，事务在这个例子上表现就是在下单前和下单之后，商品的总数量是不变的。</p>\n<p>我们以这个例子来说明一下事务和分布式事务：</p>\n<h2 id=\"1事务\"><a class=\"anchor\" href=\"#1事务\">#</a> 1. 事务</h2>\n<p>上面例子涉及到两个数据库操作</p>\n<ul>\n<li>在库存表减少商品的库存数量</li>\n<li>新增一个订单记录订单购买的商品数量</li>\n</ul>\n<p>这两个操作必须作为一个整体执行，要么两个都成功，要么两个都执行失败，这就是事务了，事务具有 ACID 四个基本特性</p>\n<ol>\n<li>\n<p><strong>Atomicity（原子性）</strong>：一个事务中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被恢复到事务开始前的状态，就像这个事务从来没有执行过一样。</p>\n</li>\n<li>\n<p><strong>Consistency（一致性）</strong>：在事务开始之前和事务结束以后，数据库的完整性没有被破坏。完整性包括外键约束、应用定义的等约束不会被破坏。</p>\n</li>\n<li>\n<p><strong>Isolation（隔离性）</strong>：数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。</p>\n<p>四种隔离级别比较</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th><strong>脏读</strong></th>\n<th><strong>不可重复读</strong></th>\n<th><strong>幻读</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>读未提交</strong></td>\n<td>可能</td>\n<td>可能</td>\n<td>可能</td>\n</tr>\n<tr>\n<td><strong>读已提交</strong></td>\n<td>不会</td>\n<td>可能</td>\n<td>可能</td>\n</tr>\n<tr>\n<td><strong>可重复读</strong></td>\n<td>不会</td>\n<td>不会</td>\n<td>可能</td>\n</tr>\n<tr>\n<td><strong>串行化</strong></td>\n<td>不会</td>\n<td>不会</td>\n<td>不会</td>\n</tr>\n</tbody>\n</table>\n<p>串行化是最高的事务隔离级别，同时代价也花费最高，性能很低，一般很少使用，在该级别下，事务顺序执行，不仅可以避免脏读、不可重复读，还避免了幻读</p>\n</li>\n<li>\n<p><strong>Durability（持久性）</strong>：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。</p>\n</li>\n</ol>\n<h2 id=\"2分布式事务\"><a class=\"anchor\" href=\"#2分布式事务\">#</a> 2. 分布式事务</h2>\n<p>分布式事务就是指事务的发起者、资源及资源管理器和事务协调者分别位于分布式系统的不同节点之上，由于分布式应用可能部署在不一样的机器上，所以一般都需要一个事务协调者对事务进行统一调度，来控制事务的提交和撤回，本质上来说，分布式事务就是为了保证在分布式场景下，数据操作的正确执行。</p>\n<p>根据 BASE 理论，分布式事务需要在数据一致性和实时性根据业务需要做出必要协调，基本思想包含以下三种情况：</p>\n<ul>\n<li>\n<p><strong>B</strong>asic <strong>A</strong>vailability 基本业务可用性</p>\n<p>分布式系统再出现故障时，允许损失部分可用功能，保证核心功能可用，如电商网站交易付款出现问题了，商品浏览仍然可以访问。</p>\n</li>\n<li>\n<p><strong>S</strong>oft state 柔性事务</p>\n<p>由于不要求强一致性，所以 BASE 系统中允许存在中间状态（也叫软状态），这个状态不影响系统可用性，如订单的 “支付中”，“数据同步中” 等状态，待数据最终一致后，状态改为 “成功” 状态</p>\n</li>\n<li>\n<p><strong>E</strong>ventual consistency 最终一致性</p>\n<p>是指经过一段时间后，所有数据都将达到一致。如订单中的 “支付中” 状态，最终会变为 “支付成功” 或 “支付失败”，使订单状态与实际交易结果达成一致，但需要一定的延迟等待</p>\n</li>\n</ul>\n<p>当然，分布式事务也遵循 ACID 基本特性，但是在一致性和隔离性方面允许在实时方面做出一定让步</p>\n<h1 id=\"二-分布式事务解决方案\"><a class=\"anchor\" href=\"#二-分布式事务解决方案\">#</a> 二、分布式事务解决方案</h1>\n<p>根据现有的分布式理论和现有的分布式框架，可以归纳以下几种解决方案</p>\n<h2 id=\"1两阶段提交-two-phase-commit-又称-xc\"><a class=\"anchor\" href=\"#1两阶段提交-two-phase-commit-又称-xc\">#</a> 1. 两阶段提交 (Two Phase Commit, 又称 XC)</h2>\n<p>二阶段提交 (Two-phaseCommit) 是指，在计算机网络以及数据库领域内，为了使基于分布式系统架构下的所有节点在进行事务提交时<strong>保持一致性</strong>而设计的一种算法 (Algorithm)。通常，二阶段提交也被称为是一种协议 (Protocol))。<strong>当一个事务跨越多个节点时</strong>，<strong>为了保持事务的 ACID 特性</strong>，需要<strong>引入一个作为协调者的组件 TM (Transaction Manage)</strong> 来统一掌控所有节点 (称作参与者或者资源管理者<strong> Resource Manage</strong>) 的操作结果并最终指示这些节点是否要把操作结果进行真正的提交 (比如将更新后的数据写入磁盘等等)。</p>\n<h3 id=\"a两阶段说明\"><a class=\"anchor\" href=\"#a两阶段说明\">#</a> a. 两阶段说明</h3>\n<ul>\n<li>\n<p><strong>投票阶段 (Voting Phase 又叫准备阶段)</strong></p>\n<p>这个阶段由主程序进行 TM 的创建，完成所有 RM 在 TM 上的注册之后完成以下三个过程</p>\n<ul>\n<li>协调者的询问 下图 1 步骤</li>\n<li>资源管理者的事务执行 下图 1.1</li>\n<li>资源管理者反馈执行信息 下图 1.2</li>\n</ul>\n</li>\n<li>\n<p><strong>提交阶段 (Commit Phase 又叫执行阶段)</strong></p>\n<p>​\t步骤根据准备阶段提交的通知，进行提交或者回滚处理</p>\n<ul>\n<li>如果所有 RM 都成功执行，则通知所有节点进行事务提交</li>\n<li>反之有一个或多个 RM 执行失败，则通知所有节点进行回滚操作</li>\n</ul>\n</li>\n</ul>\n<pre class=\"mermaid\"><svg id=\"mermaid-1661934209391\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" height=\"509\" style=\"max-width: 616.5px;\" viewBox=\"-50 -10 616.5 509\"><g></g><g><line id=\"actor0\" x1=\"75\" y1=\"5\" x2=\"75\" y2=\"498\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"0\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;\"><tspan x=\"75\" dy=\"0\">事务协调者TM</tspan></text></g><g><line id=\"actor1\" x1=\"431\" y1=\"5\" x2=\"431\" y2=\"498\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"356\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"431\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;\"><tspan x=\"431\" dy=\"0\">资源管理者RM</tspan></text></g><defs><marker id=\"arrowhead\" refX=\"5\" refY=\"2\" markerWidth=\"6\" markerHeight=\"4\" orient=\"auto\"><path d=\"M 0,0 V 4 L6,2 Z\"></path></marker></defs><defs><marker id=\"crosshead\" markerWidth=\"15\" markerHeight=\"8\" orient=\"auto\" refX=\"16\" refY=\"4\"><path fill=\"black\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 9,2 V 6 L16,4 Z\" style=\"stroke-dasharray: 0, 0;\"></path><path fill=\"none\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 0,1 L 6,7 M 6,1 L 0,7\" style=\"stroke-dasharray: 0, 0;\"></path></marker></defs><defs><marker id=\"sequencenumber\" refX=\"15\" refY=\"15\" markerWidth=\"60\" markerHeight=\"40\" orient=\"auto\"><circle cx=\"15\" cy=\"15\" r=\"6\"></circle></marker></defs><text x=\"253\" y=\"80\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">1.询问各个资源管理者是否可以正常执行</text><line x1=\"75\" y1=\"113\" x2=\"431\" y2=\"113\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line><text x=\"431\" y=\"128\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">1.1 执行事务但不提交</text><path d=\"M 431,161 C 491,151 491,191 431,181\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></path><text x=\"253\" y=\"206\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">1.2 所有参与者都能成功执行事务</text><line x1=\"431\" y1=\"239\" x2=\"75\" y2=\"239\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line><text x=\"253\" y=\"254\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">2.向所有通知者发送提交通知</text><line x1=\"75\" y1=\"287\" x2=\"431\" y2=\"287\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line><text x=\"431\" y=\"302\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">2.1 提交事务，释放资源</text><path d=\"M 431,335 C 491,325 491,365 431,355\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></path><text x=\"253\" y=\"380\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">2.2 反馈事务执行结果</text><line x1=\"431\" y1=\"413\" x2=\"75\" y2=\"413\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line><g><rect x=\"0\" y=\"433\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"465.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;\"><tspan x=\"75\" dy=\"0\">事务协调者TM</tspan></text></g><g><rect x=\"356\" y=\"433\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"431\" y=\"465.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;\"><tspan x=\"431\" dy=\"0\">资源管理者RM</tspan></text></g></svg></pre><blockquote>\n<p>1）协调者节点向所有参与者节点发出” 正式提交 (commit)” 的请求。<br />\n2）参与者节点正式完成操作，并释放在整个事务期间内占用的资源。<br />\n3）参与者节点向协调者节点发送” 完成” 消息。<br />\n4）协调者节点受到所有参与者节点反馈的” 完成” 消息后，完成事务。</p>\n<p>上图为了表达两阶段的过程，简化实际的步骤，去除了主程序创建 TM 的操作和 RM 注册到 TM 的操作</p>\n</blockquote>\n<h3 id=\"b两阶段提交的特点\"><a class=\"anchor\" href=\"#b两阶段提交的特点\">#</a> b. 两阶段提交的特点</h3>\n<ul>\n<li>\n<p>简单易理解，开发较容易</p>\n</li>\n<li>\n<p>对资源进行了长时间的锁定，并发度低</p>\n</li>\n<li>\n<p>单点故障问题</p>\n<p>由于协调者的重要性，<strong>一旦协调者发生故障。参与者会一直阻塞下去。</strong><br />\n尤其在第二阶段，协调者发生故障，那么所有的参与者还都处于<strong>锁定事务资源的状态中</strong>，而无法继续完成事务操作</p>\n<p>【协调者发出 Commit 消息<strong>之前</strong>宕机的情况】<br />\n（如果是协调者挂掉，可以重新选举一个协调者，但是<strong>无法解决因为协调者宕机导致的参与者处于阻塞状态的问题</strong>）</p>\n</li>\n<li>\n<p><strong>数据不一致</strong></p>\n<p>在二阶段提交的<strong>阶段二中</strong>，当协调者向参与者发送 commit 请求之后，发生了局部网络异常或者在发送 commit 请求过程中协调者发生了故障，这回导致只有一部分参与者接受到了 commit 请求。而在这部分参与者接到 commit 请求之后就会执行 commit 操作。但是其他部分未接到 commit 请求的机器则无法执行事务提交。于是整个分布式系统便出现了数据不一致性的现象。</p>\n</li>\n</ul>\n<h2 id=\"2三阶段提交three-phase-commit\"><a class=\"anchor\" href=\"#2三阶段提交three-phase-commit\">#</a> 2. 三阶段提交 (Three Phase Commit)</h2>\n<p>由于二阶段提交存在着诸如<strong>同步阻塞、单点问题、脑裂</strong>等缺陷，所以，研究者们在二阶段提交的基础上做了改进，提出了三阶段提交</p>\n<blockquote>\n<p>三阶段提交（Three-phase commit），也叫三阶段提交协议（Three-phase commit protocol），是二阶段提交（2PC）的改进版本。与两阶段不同的是加入了两个不同点</p>\n<p>1、引入<strong>超时机制</strong>。同时在协调者和参与者中都引入超时机制。<br />\n2、在第一阶段和第二阶段中插入一个 ** 准备阶段，** 保证了在最后提交阶段之前各参与节点状态的一致。</p>\n</blockquote>\n<h3 id=\"a三阶段定义\"><a class=\"anchor\" href=\"#a三阶段定义\">#</a> a. 三阶段定义</h3>\n<p>三阶段其实就是把两阶段的投票阶段一分为二，于是有了以下三阶段</p>\n<ul>\n<li>CanCommit 阶段</li>\n<li>PreCommit 阶段</li>\n<li>DoCommit 阶段</li>\n</ul>\n<pre class=\"mermaid\"><svg id=\"mermaid-1661934211225\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" height=\"683\" style=\"max-width: 583.5px;\" viewBox=\"-50 -10 583.5 683\"><g></g><g><line id=\"actor0\" x1=\"75\" y1=\"5\" x2=\"75\" y2=\"672\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"0\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;\"><tspan x=\"75\" dy=\"0\">TM</tspan></text></g><g><line id=\"actor1\" x1=\"306\" y1=\"5\" x2=\"306\" y2=\"672\" class=\"actor-line\" stroke-width=\"0.5px\" stroke=\"#999\"></line><rect x=\"231\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"306\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;\"><tspan x=\"306\" dy=\"0\">RM</tspan></text></g><defs><marker id=\"arrowhead\" refX=\"5\" refY=\"2\" markerWidth=\"6\" markerHeight=\"4\" orient=\"auto\"><path d=\"M 0,0 V 4 L6,2 Z\"></path></marker></defs><defs><marker id=\"crosshead\" markerWidth=\"15\" markerHeight=\"8\" orient=\"auto\" refX=\"16\" refY=\"4\"><path fill=\"black\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 9,2 V 6 L16,4 Z\" style=\"stroke-dasharray: 0, 0;\"></path><path fill=\"none\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 0,1 L 6,7 M 6,1 L 0,7\" style=\"stroke-dasharray: 0, 0;\"></path></marker></defs><defs><marker id=\"sequencenumber\" refX=\"15\" refY=\"15\" markerWidth=\"60\" markerHeight=\"40\" orient=\"auto\"><circle cx=\"15\" cy=\"15\" r=\"6\"></circle></marker></defs><text x=\"191\" y=\"80\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">第一阶段：canCommit</text><line x1=\"75\" y1=\"113\" x2=\"306\" y2=\"113\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line><text x=\"306\" y=\"128\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">检查时候能执行事务</text><path d=\"M 306,161 C 366,151 366,191 306,181\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></path><text x=\"191\" y=\"206\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">yes</text><line x1=\"306\" y1=\"239\" x2=\"75\" y2=\"239\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line><text x=\"191\" y=\"254\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">第二阶段：preCommit</text><line x1=\"75\" y1=\"287\" x2=\"306\" y2=\"287\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line><text x=\"306\" y=\"302\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">执行事务操作，将undo和redo信息记录到事务日志</text><path d=\"M 306,335 C 366,325 366,365 306,355\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></path><text x=\"191\" y=\"380\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">Ack</text><line x1=\"306\" y1=\"413\" x2=\"75\" y2=\"413\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line><text x=\"191\" y=\"428\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">第三阶段：doCommit</text><line x1=\"75\" y1=\"461\" x2=\"306\" y2=\"461\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line><text x=\"306\" y=\"476\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">提交事务</text><path d=\"M 306,509 C 366,499 366,539 306,529\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></path><text x=\"191\" y=\"554\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial; font-size: 16px; font-weight: 400;\">commited</text><line x1=\"306\" y1=\"587\" x2=\"75\" y2=\"587\" class=\"messageLine1\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"stroke-dasharray: 3, 3; fill: none;\"></line><g><rect x=\"0\" y=\"607\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"639.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;\"><tspan x=\"75\" dy=\"0\">TM</tspan></text></g><g><rect x=\"231\" y=\"607\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"306\" y=\"639.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;\"><tspan x=\"306\" dy=\"0\">RM</tspan></text></g></svg></pre><blockquote>\n<p><strong>为什么要把投票阶段一分为二？</strong></p>\n<p><strong>假设有 1 个协调者，9 个参与者。其中有一个参与者不具备执行该事务的能力。</strong><br />\n协调者发出 prepare 消息之后，其余参与者都将资源锁住，执行事务，写入 undo 和 redo 日志。<br />\n协调者收到相应之后，发现有一个参与者不能参与。所以，又出一个 roolback 消息。其余 8 个参与者，又对消息进行回滚。这样子，是不是做了很多无用功？<br />\n所以 **，** 引入 can-Commit 阶段，<strong>主要是为了在预执行之前，保证所有参与者都具备可执行条件，从而减少资源浪费。</strong></p>\n</blockquote>\n<h3 id=\"b具体执行过程\"><a class=\"anchor\" href=\"#b具体执行过程\">#</a> b. 具体执行过程</h3>\n<ul>\n<li><strong>CanCommit 阶段</strong></li>\n</ul>\n<p>3PC 的 CanCommit 阶段其实和 2PC 的准备阶段很像。协调者向参与者发送 commit 请求，参与者如果可以提交就返回 Yes 响应，否则返回 No 响应。</p>\n<blockquote>\n<p><strong>1. 事务询问</strong> 协调者向参与者发送 CanCommit 请求。询问是否可以执行事务提交操作。然后开始等待参与者的响应。<br />\n<strong>2. 响应反馈</strong> 参与者接到 CanCommit 请求之后，正常情况下，如果其自身认为可以顺利执行事务，则返回 Yes 响应，并进入预备状态。否则反馈 No</p>\n</blockquote>\n<ul>\n<li><strong>PreCommit 阶段</strong></li>\n</ul>\n<p>本阶段协调者会根据第一阶段的询盘结果采取相应操作，询盘结果主要有两种：</p>\n<p>** 情况 1-** 假如协调者从所有的参与者获得的反馈都是 Yes 响应，那么就会执行事务的预执行：</p>\n<blockquote>\n<p><strong>1. 发送预提交请求</strong> 协调者向参与者发送 PreCommit 请求，并进入 Prepared 阶段。<br />\n<strong>2. 事务预提交</strong> 参与者接收到 PreCommit 请求后，会执行事务操作，并将 undo 和 redo 信息记录到事务日志中。<br />\n<strong>3. 响应反馈</strong> 如果参与者成功的执行了事务操作，则返回 ACK 响应，同时开始等待最终指令。</p>\n</blockquote>\n<p>** 情况 2-** 假如有任何一个参与者向协调者发送了 No 响应，或者等待超时之后，协调者都没有接到参与者的响应，那么就执行事务的中断。具体步骤如下：</p>\n<blockquote>\n<p><strong>1. 发送中断请求</strong> 协调者向所有参与者发送 abort 请求。<br />\n<strong>2. 中断事务</strong> 参与者收到来自协调者的 abort 请求之后（或超时之后，仍未收到协调者的请求），执行事务的中断。</p>\n</blockquote>\n<ul>\n<li><strong>doCommit 阶段</strong></li>\n</ul>\n<p>该阶段进行真正的事务提交，也可以分为以下两种情况。</p>\n<p><strong>情况 1 - 执行提交</strong></p>\n<p>针对第一种情况，协调者向各个参与者发起事务提交请求，具体步骤如下：</p>\n<blockquote>\n<p>1. 协调者向所有参与者发送事务 commit 通知<br />\n 2. 所有参与者在收到通知之后执行 commit 操作，并释放占有的资源<br />\n 3. 参与者向协调者反馈事务提交结果</p>\n</blockquote>\n<p><strong>情况 2 - 中断事务</strong></p>\n<p>协调者没有接收到参与者发送的 ACK 响应（可能是接受者发送的不是 ACK 响应，也可能响应超时），那么就会执行中断事务。具体步骤如下：</p>\n<blockquote>\n<p>1.<strong> 发送中断请求</strong> 协调者向所有参与者发送事务 rollback 通知。<br />\n2.<strong> 事务回滚</strong> 所有参与者在收到通知之后执行 rollback 操作，并释放占有的资源。<br />\n3.<strong> 反馈结果</strong> 参与者向协调者反馈事务提交结果。<br />\n4.<strong> 中断事务</strong> 协调者接收到参与者反馈的 ACK 消息之后，执行事务的中断。</p>\n</blockquote>\n<h2 id=\"3saga\"><a class=\"anchor\" href=\"#3saga\">#</a> 3.SAGA</h2>\n<h3 id=\"a基本概念\"><a class=\"anchor\" href=\"#a基本概念\">#</a> a. 基本概念</h3>\n<p>Saga 是这一篇数据库论文 saga 提到的一个方案。其核心思想是将长事务拆分为多个本地短事务，由 Saga 事务协调器协调，如果正常结束那就正常完成，如果某个步骤失败，则根据相反顺序一次调用补偿操作。</p>\n<p>在 Saga 模式中：</p>\n<ul>\n<li><em>可补偿事务</em> 是通过处理另一个具有相反效果的事务来撤消的事务。</li>\n<li><em>透视事务</em>是传奇中的 go/no-go 点。 如果透视事务提交，则 saga 将运行到完成为止。 透视事务可以是既不可补偿也不可重试的事务，也可以是最后一个可补偿事务，也可以是传奇中的第一个可重试事务。</li>\n<li><em>可重试事务</em> 是遵循透视事务且保证成功事务的事务。</li>\n</ul>\n<p>有两种常见的传奇实现方法， <em>即编舞</em> 和 <em>业务流程</em>。 每个方法都有自己的一组挑战和技术来协调工作流。</p>\n<h3 id=\"bsaga事务的特点\"><a class=\"anchor\" href=\"#bsaga事务的特点\">#</a> b.SAGA 事务的特点：</h3>\n<ul>\n<li>并发度高，不用像 XA 事务那样长期锁定资源</li>\n<li>需要定义正常操作以及补偿操作，开发量比 XA 大</li>\n<li>一致性较弱，对于转账，可能发生 A 用户已扣款，最后转账又失败的情况</li>\n</ul>\n<p>论文里面的 SAGA 内容较多，包括两种恢复策略，包括分支事务并发执行，我们这里的讨论，仅包括最简单的 SAGA</p>\n<p>SAGA 适用的场景较多，长事务适用，对中间结果不敏感的业务场景适用</p>\n<p>如果读者想要进一步研究 SAGA，go 语言可参考 DTM，java 语言可参考 seata</p>\n<h2 id=\"4tcc-try-confirm-cancel\"><a class=\"anchor\" href=\"#4tcc-try-confirm-cancel\">#</a> 4.TCC (Try-Confirm-Cancel)</h2>\n<h3 id=\"a基本概念-2\"><a class=\"anchor\" href=\"#a基本概念-2\">#</a> a. 基本概念</h3>\n<p>关于 TCC（Try-Confirm-Cancel）的概念，最早是由 Pat Helland 于 2007 年发表的一篇名为《Life beyond Distributed Transactions:an Apostate’s Opinion》的论文提出。</p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/06/seata_tcc-1.jpg\" alt=\"\" /></p>\n<p><strong>TCC 分为 3 个阶段</strong></p>\n<ul>\n<li>Try 阶段：尝试执行，完成所有业务检查（一致性）, 预留必须业务资源（准隔离性）</li>\n<li>Confirm 阶段：确认执行真正执行业务，不作任何业务检查，只使用 Try 阶段预留的业务资源，Confirm     操作要求具备幂等设计，Confirm 失败后需要进行重试。</li>\n<li>Cancel 阶段：取消执行，释放 Try 阶段预留的业务资源。Cancel 阶段的异常和 Confirm     阶段异常处理方案基本上一致，要求满足幂等设计。</li>\n</ul>\n<p>把上面商城下单为例，在 try 阶段会冻结商品的库存数量，并不真正减少库存，而是在 Confirm 里面进行库存的扣减，Cancel 里进行库存解冻。</p>\n<pre class=\"mermaid graph\"><svg id=\"mermaid-1661934213923\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"113\" style=\"max-width: 559.515625px;\" viewBox=\"0 1 559.515625 113\"><g><g class=\"output\"><g class=\"clusters\"></g><g class=\"edgePaths\"><g class=\"edgePath LS-A LE-B\" id=\"L-A-B\" style=\"opacity: 1;\"><path class=\"path\" d=\"M112.40625,37.46713409290096L167.171875,17.5L226.28125,37\" marker-end=\"url(#arrowhead20)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead20\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-B LE-C\" id=\"L-B-C\" style=\"opacity: 1;\"><path class=\"path\" d=\"M348.84375,56.5L401.4609375,56.5L454.078125,56.5\" marker-end=\"url(#arrowhead21)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead21\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-B LE-A\" id=\"L-B-A\" style=\"opacity: 1;\"><path class=\"path\" d=\"M221.9375,56.5L167.171875,56.5L112.40625,56.5\" marker-end=\"url(#arrowhead22)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead22\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath LS-B LE-A\" id=\"L-B-A\" style=\"opacity: 1;\"><path class=\"path\" d=\"M226.28125,76L167.171875,95.5L112.40625,75.53286590709904\" marker-end=\"url(#arrowhead23)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead23\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g></g><g class=\"edgeLabels\"><g class=\"edgeLabel\" transform=\"translate(167.171875,17.5)\" style=\"opacity: 1;\"><g transform=\"translate(-10.28125,-9.5)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"20.5625\" height=\"19\"></rect><text><tspan xml:space=\"preserve\" dy=\"1em\" x=\"1\">try</tspan></text></g></g><g class=\"edgeLabel\" transform=\"translate(401.4609375,56.5)\" style=\"opacity: 1;\"><g transform=\"translate(-27.6171875,-9.5)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"55.234375\" height=\"19\"></rect><text><tspan xml:space=\"preserve\" dy=\"1em\" x=\"1\">confirm</tspan></text></g></g><g class=\"edgeLabel\" transform=\"translate(167.171875,56.5)\" style=\"opacity: 1;\"><g transform=\"translate(-24.1875,-9.5)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"48.375\" height=\"19\"></rect><text><tspan xml:space=\"preserve\" dy=\"1em\" x=\"1\">Cancel</tspan></text></g></g><g class=\"edgeLabel\" transform=\"translate(167.171875,95.5)\" style=\"opacity: 1;\"><g transform=\"translate(-29.765625,-9.5)\" class=\"label\"><rect rx=\"0\" ry=\"0\" width=\"59.53125\" height=\"19\"></rect><text><tspan xml:space=\"preserve\" dy=\"1em\" x=\"1\">Timeout</tspan></text></g></g></g><g class=\"nodes\"><g class=\"node default\" id=\"flowchart-A-8\" transform=\"translate(60.203125,56.5)\" style=\"opacity: 1;\"><rect rx=\"5\" ry=\"5\" x=\"-52.203125\" y=\"-19.5\" width=\"104.40625\" height=\"39\" class=\"label-container\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-42.203125,-9.5)\"><text style=\"\"><tspan xml:space=\"preserve\" dy=\"1em\" x=\"1\">Initial State</tspan></text></g></g></g><g class=\"node default\" id=\"flowchart-B-9\" transform=\"translate(285.390625,56.5)\" style=\"opacity: 1;\"><rect rx=\"5\" ry=\"5\" x=\"-63.453125\" y=\"-19.5\" width=\"126.90625\" height=\"39\" class=\"label-container\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-53.453125,-9.5)\"><text style=\"\"><tspan xml:space=\"preserve\" dy=\"1em\" x=\"1\">Reserved State</tspan></text></g></g></g><g class=\"node default\" id=\"flowchart-C-11\" transform=\"translate(502.796875,56.5)\" style=\"opacity: 1;\"><rect rx=\"5\" ry=\"5\" x=\"-48.71875\" y=\"-19.5\" width=\"97.4375\" height=\"39\" class=\"label-container\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-38.71875,-9.5)\"><text style=\"\"><tspan xml:space=\"preserve\" dy=\"1em\" x=\"1\">Final State</tspan></text></g></g></g></g></g></g></svg></pre><h3 id=\"btcc特点\"><a class=\"anchor\" href=\"#btcc特点\">#</a> b.TCC 特点</h3>\n<ul>\n<li>\n<p>并发度较高，无长期资源锁定。</p>\n</li>\n<li>\n<p>开发量较大，需要提供 Try/Confirm/Cancel 接口。</p>\n</li>\n<li>\n<p><strong>一致性较好，不会发生 SAGA 已扣款最后又转账失败的情况</strong></p>\n</li>\n<li>\n<p>TCC 适用于订单类业务，对中间状态有约束的业务</p>\n</li>\n<li>\n<p>若【发起方】/【参与方】因崩溃遗失了信息，则会造成有的【参与方】已 Confirm，有的【参与方】则被 Cancel 了，甚至于依然保持在预留状态。</p>\n</li>\n</ul>\n<h2 id=\"5本地消息表\"><a class=\"anchor\" href=\"#5本地消息表\">#</a> 5. 本地消息表</h2>\n<p>本地消息表这个方案最初是 ebay 架构师 Dan Pritchett 在 2008 年发表给 ACM 的文章。设计核心是将需要分布式处理的任务通过消息的方式来异步确保执行。</p>\n<p>以前面商城下单为例，本地消息表的执行过程如下：</p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/06/20220622170428.png\" alt=\"\" /></p>\n<p>写本地消息和业务操作放在一个事务里，保证了业务和发消息的原子性，要么他们全都成功，要么全都失败。</p>\n<p><strong>容错机制：</strong></p>\n<ul>\n<li>扣减余额事务 失败时，事务直接回滚，无后续步骤</li>\n<li>轮序生产消息失败， 增加余额事务失败都会进行重试</li>\n</ul>\n<p><strong>本地消息表的特点：</strong></p>\n<ul>\n<li>长事务仅需要分拆成多个任务，使用简单</li>\n<li>生产者需要额外的创建消息表</li>\n<li>每个本地消息表都需要进行轮询</li>\n<li>消费者的逻辑如果无法通过重试成功，那么还需要更多的机制，来回滚操作</li>\n</ul>\n<p>适用于可异步执行的业务，且后续操作无需回滚的业务</p>\n<h2 id=\"6事务消息\"><a class=\"anchor\" href=\"#6事务消息\">#</a> 6. 事务消息</h2>\n<p>在上述的本地消息表方案中，生产者需要额外创建消息表，还需要对本地消息表进行轮询，业务负担较重。阿里开源的 RocketMQ 4.3 之后的版本正式支持事务消息，该事务消息本质上是把本地消息表放到 RocketMQ 上（实际上就是把上图 2 的步骤使用支持事务的消息队列替换），解决生产端的消息发送与本地事务执行的原子性问题。</p>\n<p>事务消息发送及提交：</p>\n<ul>\n<li>发送消息（half 消息）</li>\n<li>服务端存储消息，并响应消息的写入结果</li>\n<li>根据发送结果执行本地事务（如果写入失败，此时 half 消息对业务不可见，本地逻辑不执行）</li>\n<li>根据本地事务状态执行 Commit 或者 Rollback（Commit 操作发布消息，消息对消费者可见）</li>\n</ul>\n<p><strong>补偿流程：</strong></p>\n<p>对没有 Commit/Rollback 的事务消息（pending 状态的消息），从服务端发起一次 “回查”</p>\n<p>Producer 收到回查消息，返回消息对应的本地事务的状态，为 Commit 或者 Rollback</p>\n<p>事务消息方案与本地消息表机制非常类似，区别主要在于原先相关的本地表操作替换成了一个反查接口</p>\n<p><strong>事务消息特点如下：</strong></p>\n<ul>\n<li>长事务仅需要分拆成多个任务，并提供一个反查接口，使用简单</li>\n<li>消费者的逻辑如果无法通过重试成功，那么还需要更多的机制，来回滚操作</li>\n</ul>\n<p>适用于可异步执行的业务，且后续操作无需回滚的业务</p>\n<p>如果读者想要进一步研究事务消息，可参考 rocketmq，为了方便大家学习事务消息，DTM 也提供了简单实现</p>\n<h2 id=\"7最大努力通知\"><a class=\"anchor\" href=\"#7最大努力通知\">#</a> 7. 最大努力通知</h2>\n<p>发起通知方通过一定的机制最大努力将业务处理结果通知到接收方。具体包括：</p>\n<p>有一定的消息重复通知机制。因为接收通知方可能没有接收到通知，此时要有一定的机制对消息重复通知。</p>\n<p>消息校对机制。如果尽最大努力也没有通知到接收方，或者接收方消费消息后要再次消费，此时可由接收方主动向通知方查询消息信息来满足需求。</p>\n<p>前面介绍的的本地消息表和事务消息都属于可靠消息，与这里介绍的最大努力通知有什么不同？</p>\n<p>可靠消息一致性，发起通知方需要保证将消息发出去，并且将消息发到接收通知方，消息的可靠性关键由发起通知方来保证。</p>\n<p>最大努力通知，发起通知方尽最大的努力将业务处理结果通知为接收通知方，但是可能消息接收不到，此时需要接收通知方主动调用发起通知方的接口查询业务处理结果，通知的可靠性关键在接收通知方。</p>\n<p><strong>解决方案上，最大努力通知需要：</strong></p>\n<ul>\n<li>提供接口，让接受通知放能够通过接口查询业务处理结果</li>\n<li>消息队列 ACK 机制，消息队列按照间隔 1min、5min、10min、30min、1h、2h、5h、10h 的方式，逐步拉大通知间隔     ，直到达到通知要求的时间窗口上限。之后不再通知</li>\n</ul>\n<p>最大努力通知适用于业务通知类型，例如微信交易的结果，就是通过最大努力通知方式通知各个商户，既有回调通知，也有交易查询接口</p>\n<h2 id=\"8at事务模式\"><a class=\"anchor\" href=\"#8at事务模式\">#</a> 8.AT 事务模式</h2>\n<p>这是阿里开源项目 seata 中的一种事务模式，在蚂蚁金服也被称为 FMT。优点是该事务模式使用方式，类似 XA 模式，业务无需编写各类补偿操作，回滚由框架自动完成，缺点也类似 AT，存在较长时间的锁，不满足高并发的场景。有兴趣的同学可以参考 seata-AT</p>\n<h1 id=\"三-分布式事务中的异常处理\"><a class=\"anchor\" href=\"#三-分布式事务中的异常处理\">#</a> 三、分布式事务中的异常处理</h1>\n<p>分布式事务中，会由于网络和业务异常问题导致 TM 和 RM 之间的通信问题，主要包括下面三类：</p>\n<h2 id=\"空回滚\"><a class=\"anchor\" href=\"#空回滚\">#</a> 空回滚</h2>\n<p>在没有调用 TCC 资源 Try 方法的情况下，调用了二阶段的 Cancel 方法，Cancel 方法需要识别出这是一个空回滚，然后直接返回成功。</p>\n<p>出现原因是当一个分支事务所在服务宕机或网络异常，分支事务调用记录为失败，这个时候其实是没有执行 Try 阶段，当故障恢复后，分布式事务进行回滚则会调用二阶段的 Cancel 方法，从而形成空回滚。</p>\n<h2 id=\"幂等\"><a class=\"anchor\" href=\"#幂等\">#</a> 幂等</h2>\n<p>由于任何一个请求都可能出现网络异常，出现重复请求，所以所有的分布式事务分支，都需要保证幂等性</p>\n<h2 id=\"悬挂\"><a class=\"anchor\" href=\"#悬挂\">#</a> 悬挂</h2>\n<p>悬挂就是对于一个分布式事务，其二阶段 Cancel 接口比 Try 接口先执行。</p>\n<p>出现原因是在 RPC 调用分支事务 try 时，先注册分支事务，再执行 RPC 调用，如果此时 RPC 调用的网络发生拥堵，RPC 超时以后，TM 就会通知 RM 回滚该分布式事务，可能回滚完成后，RPC 请求才到达参与者真正执行。</p>\n<blockquote>\n<p>参考文章：<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI4MTE4MDUvYXJ0aWNsZS9kZXRhaWxzLzEyMTMxMzAwNg==\">分布式事务七种解决方案，最后一种经典了！_独行侠梦的博客 - CSDN 博客</span><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zNTYxNjgxMA==\">分布式一致性之两阶段提交协议、三阶提交协议 - 知乎 (zhihu.com)</span></p>\n</blockquote>\n",
            "tags": [
                "后端",
                "Java",
                "微服务",
                "微服务中间件",
                "分布式事务",
                "Spring Cloud"
            ]
        },
        {
            "id": "https://blog.liq2.com/article/55b5aa61",
            "url": "https://blog.liq2.com/article/55b5aa61",
            "title": "说一说微服务网关",
            "date_published": "2022-06-21T10:18:03.000Z",
            "content_html": "<h1 id=\"什么是微服务网关\"><a class=\"anchor\" href=\"#什么是微服务网关\">#</a> 什么是微服务网关？</h1>\n<p>微服务网关是微服务架构系统的唯一入口，能把系统的能力统一经过它对客户端进行开放，类似于面向对象的封装，提供统一的入口，具体里面的业务方法是怎样实现并不公开，只不过网关封装了系统内部架构，为每个客户端提供一个定制的 API。</p>\n<p>基于他是所有 API 的入口这个特性， 所以它可以方便的全局实现如身份验证 (黑白名单)、监控、负载均衡、缓存、协议转换、限流熔断、灰度发布等功能。</p>\n<p><code>微服务网关作为连接服务的消费方和服务提供方的中间件系统，将各自的业务系统的演进和发展做了天然的隔离，使业务系统更加专注于业务服务本身，同时微服务网关还可以为服务提供和沉淀更多附加功能</code></p>\n<p>它的主要作用：</p>\n<ul>\n<li>\n<p>请求接入</p>\n<p>管理所有接入请求，作为所有 API 请求的入口</p>\n</li>\n<li>\n<p>业务聚合</p>\n<p>所有微服务后端可以注册在 API 网关，通过 API 网关统一暴露服务</p>\n</li>\n<li>\n<p>拦截策略</p>\n<p>可以提供统一增加安全、路由、流控、负载均衡等公共服务组件</p>\n</li>\n<li>\n<p>统一管理</p>\n<p>提供统一监控管理工具，配置管理工具，Swagger 工具等设施</p>\n</li>\n</ul>\n<h2 id=\"1过滤器与网关的区别\"><a class=\"anchor\" href=\"#1过滤器与网关的区别\">#</a> 1. 过滤器与网关的区别</h2>\n<ul>\n<li>过滤器只适合当个服务的过滤请求</li>\n<li>网关能拦截整个微服务，实现过滤请求，能够解决整个微服务中的冗余代码</li>\n<li>过滤器是局部拦截，网关是全局拦截</li>\n</ul>\n<h2 id=\"2-zuul与gateway有哪些区别\"><a class=\"anchor\" href=\"#2-zuul与gateway有哪些区别\">#</a> 2. Zuul 与 Gateway 有哪些区别</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">项目</th>\n<th style=\"text-align:left\">Zuul</th>\n<th>GateWay</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><strong>基本说明</strong></td>\n<td style=\"text-align:left\">Zuul 是属于 netflix 公司的开源产品属于第一代网关</td>\n<td>Gateway 属于 SpringCloud 自研发的网关框架，属于第二代微服务网关</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>底层实现</strong></td>\n<td style=\"text-align:left\">Zuul 网关底层基于 Servlet 实现的，处理 http 请求，阻塞式的 Api</td>\n<td>基于 netty 环境依赖 SpringBoot-WebFux，非阻塞式 API</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>长连接支持</strong></td>\n<td style=\"text-align:left\">不支持</td>\n<td>支持</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><strong>负载均衡支持</strong></td>\n<td style=\"text-align:left\">如果需要负载均衡，需要额外集成其他负载均衡框架，可以扩展至其他微服务框架中</td>\n<td>提供了抽象负载均衡，提供了抽象流控，并默认实现了 RedisRateLimiter，仅适合于 Spring Cloud 套件</td>\n</tr>\n</tbody>\n</table>\n<p>总体来说，由于 Spring gateway 使用了支持 NIO 处理的 Netty 容器，能够非阻塞的处理客户端请求，消耗硬件资源会比 Zuul 更少，效率相对较高，同时本身支持对请求的负载均衡和限流，所以他是在 Spring Cloud 项目中的不二选择</p>\n<h1 id=\"如何使用spring-gateway\"><a class=\"anchor\" href=\"#如何使用spring-gateway\">#</a> 如何使用 Spring Gateway</h1>\n<h2 id=\"1添加依赖\"><a class=\"anchor\" href=\"#1添加依赖\">#</a> 1. 添加依赖</h2>\n<figure class=\"highlight xml\"><figcaption data-lang=\"XML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-parent<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.0.0.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>parent</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-gateway<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.0.0.RELEASE<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-web<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-loadbalancer<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"2添加配置文件applicationyml\"><a class=\"anchor\" href=\"#2添加配置文件applicationyml\">#</a> 2. 添加配置文件 application.yml</h2>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6001</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> bo<span class=\"token punctuation\">-</span>spring<span class=\"token punctuation\">-</span>gateway</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">config</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">override-system-properties</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">override-none</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">discovery</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token key atrule\">locator</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>          <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> api<span class=\"token punctuation\">-</span>web<span class=\"token punctuation\">-</span>management</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//api<span class=\"token punctuation\">-</span>web<span class=\"token punctuation\">-</span>management</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/api<span class=\"token punctuation\">-</span>web<span class=\"token punctuation\">-</span>management/<span class=\"token important\">**</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">-</span>integrated<span class=\"token punctuation\">-</span>auth</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//center<span class=\"token punctuation\">-</span>integrated<span class=\"token punctuation\">-</span>auth</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/center<span class=\"token punctuation\">-</span>integrated<span class=\"token punctuation\">-</span>auth/<span class=\"token important\">**</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">-</span>system<span class=\"token punctuation\">-</span>base</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//center<span class=\"token punctuation\">-</span>system<span class=\"token punctuation\">-</span>base</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token punctuation\">-</span> Path=/center<span class=\"token punctuation\">-</span>system<span class=\"token punctuation\">-</span>base/<span class=\"token important\">**</span></pre></td></tr></table></figure><h2 id=\"3编写启动类\"><a class=\"anchor\" href=\"#3编写启动类\">#</a> 3. 编写启动类</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@SpringBootApplication</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SpringGatewayApplication</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SpringGatewayApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>由于gateway不依赖于serverlet，注意项目启动之前检查是否去除对serverlet的依赖</code></p>\n<h2 id=\"4常用的断言和过滤器\"><a class=\"anchor\" href=\"#4常用的断言和过滤器\">#</a> 4. 常用的断言和过滤器</h2>\n<h3 id=\"断言predicates\"><a class=\"anchor\" href=\"#断言predicates\">#</a> 断言 Predicates</h3>\n<table>\n<thead>\n<tr>\n<th>规则</th>\n<th>实例</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Path</td>\n<td>- Path=/gate/<strong>,/rule/</strong></td>\n<td>## 当请求的路径为 gate、rule 开头的时，转发到 http://localhost:9023 服务器上</td>\n</tr>\n<tr>\n<td>Before</td>\n<td>- Before=2017-01-20T17:42:47.789-07:00[America/Denver]</td>\n<td>在某个时间之前的请求才会被转发到 http://localhost:9023 服务器上</td>\n</tr>\n<tr>\n<td>After</td>\n<td>- After=2017-01-20T17:42:47.789-07:00[America/Denver]</td>\n<td>在某个时间之后的请求才会被转发</td>\n</tr>\n<tr>\n<td>Between</td>\n<td>- Between=2017-01-20T17:42:47.789-07:00[America/Denver],2017-01-21T17:42:47.789-07:00[America/Denver]</td>\n<td>在某个时间段之间的才会被转发</td>\n</tr>\n<tr>\n<td>Cookie</td>\n<td>- Cookie=chocolate, ch.p</td>\n<td>名为 chocolate 的表单或者满足正则 ch.p 的表单才会被匹配到进行请求转发</td>\n</tr>\n<tr>\n<td>Header</td>\n<td>- Header=X-Request-Id, \\d+</td>\n<td>携带参数 X-Request-Id 或者满足 \\d + 的请求头才会匹配</td>\n</tr>\n<tr>\n<td>Host</td>\n<td>- <span class=\"exturl\" data-url=\"aHR0cDovL0hvc3Q9d3d3LmhkMTIzLmNvbQ==\">Host=www.hd123.com</span></td>\n<td>当主机名为 www.hd123.com 的时候直接转发到 http://localhost:9023 服务器上</td>\n</tr>\n<tr>\n<td>Method</td>\n<td>- Method=GET</td>\n<td>只有 GET 方法才会匹配转发请求，还可以限定 POST、PUT 等请求方式</td>\n</tr>\n</tbody>\n</table>\n<p>使用示例</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> query_route</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//example.org</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">-</span> Method=GET</pre></td></tr></table></figure><h3 id=\"过滤器filter\"><a class=\"anchor\" href=\"#过滤器filter\">#</a> 过滤器 Filter</h3>\n<table>\n<thead>\n<tr>\n<th>过滤规则</th>\n<th>实例</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>PrefixPath</td>\n<td>- PrefixPath=/app</td>\n<td>在请求路径前加上 app</td>\n</tr>\n<tr>\n<td>RewritePath</td>\n<td>- RewritePath=/test, /app/test</td>\n<td>访问 localhost:9022/test, 请求会转发到 localhost:8001/app/test</td>\n</tr>\n<tr>\n<td>SetPath</td>\n<td path=\"\">SetPath=/app/</td>\n<td>通过模板设置路径，转发的规则时会在路径前增加 app，{path} 表示原请求路径</td>\n</tr>\n<tr>\n<td>RedirectTo</td>\n<td></td>\n<td>重定向</td>\n</tr>\n<tr>\n<td>RemoveRequestHeader</td>\n<td></td>\n<td>去掉某个请求头信息</td>\n</tr>\n</tbody>\n</table>\n<p>过滤器常用的是请求地址的重写</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> rewrite_filter</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8081</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">-</span> Path=/test/<span class=\"token important\">**</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">-</span> RewritePath=/where(<span class=\"token punctuation\">?</span>&lt;segment<span class=\"token punctuation\">></span>/<span class=\"token punctuation\">?</span>.<span class=\"token important\">*)</span><span class=\"token punctuation\">,</span> /test(<span class=\"token punctuation\">?</span>&lt;segment<span class=\"token punctuation\">></span>/<span class=\"token punctuation\">?</span>.<span class=\"token important\">*)</span></pre></td></tr></table></figure>",
            "tags": [
                "后端",
                "Java",
                "微服务",
                "微服务中间件",
                "Spring Cloud"
            ]
        },
        {
            "id": "https://blog.liq2.com/article/adf95138",
            "url": "https://blog.liq2.com/article/adf95138",
            "title": "Promise,async,await学习总结",
            "date_published": "2022-05-28T08:08:41.000Z",
            "content_html": "<h2 id=\"一-promise的2w1h\"><a class=\"anchor\" href=\"#一-promise的2w1h\">#</a> 一、Promise 的 2W1H</h2>\n<h3 id=\"w1-什么是promise\"><a class=\"anchor\" href=\"#w1-什么是promise\">#</a> W1 什么是 Promise</h3>\n<p>Promise 是一个函数，为了解决回调地狱的一个函数，它在 js 中进行异步编程的新解决方案；它有三个状态和两个改变状态的方法，以及三个 Promise 常用的方法</p>\n<h5 id=\"三个状态\"><a class=\"anchor\" href=\"#三个状态\">#</a> 三个状态</h5>\n<ul>\n<li>pengding  执行中</li>\n<li>fulfilled  已成功，正常完成</li>\n<li>rejected  已失败，执行以错误结束</li>\n</ul>\n<h5 id=\"两个改变状态的方法\"><a class=\"anchor\" href=\"#两个改变状态的方法\">#</a> 两个改变状态的方法</h5>\n<ul>\n<li>resolve ()   把状态改成 fullfilled</li>\n<li>reject () 把状态改成 rejected</li>\n</ul>\n<h5 id=\"三个常用的方法\"><a class=\"anchor\" href=\"#三个常用的方法\">#</a> 三个常用的方法</h5>\n<ul>\n<li>then()</li>\n<li>catch()</li>\n<li>finally()</li>\n</ul>\n<h3 id=\"w2-什么时候使用promise\"><a class=\"anchor\" href=\"#w2-什么时候使用promise\">#</a> W2 什么时候使用 Promise？</h3>\n<p>解决多层套娃的异步调用导致项目代码向右下漂移，以一种只向下扩展的方式使得代码看上去就像不是异步代码一样，读起来不费劲，更优雅一些；</p>\n<p>不使用 Promise 的代码如</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'套娃第一次开始'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'套娃第二次开始'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'套娃第三次开始'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t\t<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t\t\t<span class=\"token operator\">...</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token number\">4000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>一层套一层，右下漂移了！！😲 通过 Promise 改造，可以得到以下样子的代码</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'套娃第一次开始'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'套娃第二次开始'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'套娃第三次开始'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>看上去是不是心情好得多呢，甚至可以进一步优化成下面这样：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">createTimeout</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">logContent<span class=\"token punctuation\">,</span>intevel<span class=\"token operator\">=</span><span class=\"token number\">1000</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>logContent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>intevel<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">createTimeout</span><span class=\"token punctuation\">(</span><span class=\"token string\">'套娃第一次开始'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token function\">createTimeout</span><span class=\"token punctuation\">(</span><span class=\"token string\">'套娃第二次开始'</span><span class=\"token punctuation\">,</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token function\">createTimeout</span><span class=\"token punctuation\">(</span><span class=\"token string\">'套娃第三次开始'</span><span class=\"token punctuation\">,</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>这个代码看上去就赏心悦目多了✌️</p>\n<h3 id=\"1h-如何使用\"><a class=\"anchor\" href=\"#1h-如何使用\">#</a> 1H 如何使用</h3>\n<p>如 W2 的第二部分代码可以看到，可以通过 new 的方式构造一个 Promise, 其中构造函数传入一个函数，这个函数带入两个参数 (resolve, reject)，他们就是 W1 里面所说的两个改变状态的方法 🌹</p>\n<p>如果方法体正常完成，则调用一下 resolve (),  失败就调用一下 reject ();</p>\n<h2 id=\"二-使用详解\"><a class=\"anchor\" href=\"#二-使用详解\">#</a> 二、使用详解</h2>\n<h3 id=\"如何参数传递\"><a class=\"anchor\" href=\"#如何参数传递\">#</a> 如何参数传递？</h3>\n<p>上面说的方法体内容里面其实是没有传参数到下一个异步执行的方法？自然是直接放到 resolve ()，然后下一步通过 then () 的形参方法参数直接传入到下一个异步执行的方法体，比如我们常需要在项目中拿到用户信息之后，根据用户 id 拿到角色列表，这肯定就需要第一次异步请求拿到的用户 Id，传入第二次异步请求</p>\n<p>我们假设 <code>user.json</code>  和  <code>role.json</code>  请求返回的结果分别为</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//user.json</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"userId\"</span><span class=\"token operator\">:</span> <span class=\"token number\">666</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"张三\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//role.json?userId=666</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"userId\"</span><span class=\"token operator\">:</span><span class=\"token number\">666</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"roles\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"管理员\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"普通用户\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> params<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 用了 jQuery 的 ajax 方法，调试的话请先引入 jQuery</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        $<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> url<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token literal-property property\">params</span><span class=\"token operator\">:</span>params<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token string\">'user.json'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">userInfo</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span>userId<span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> userInfo<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"用户ID:  \"</span><span class=\"token operator\">+</span>userId<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token string\">'role.json'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">userId</span><span class=\"token operator\">:</span>userId<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">roleData</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>roleData<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>如上上面通过 resolve 方法把 ajax 请求的结果传给了 then, 在 then 的参数分别通过 userInfo 和 roleData 接收，然后对数据进行了进一步的处理；</p>\n<h3 id=\"什么时候使用reject\"><a class=\"anchor\" href=\"#什么时候使用reject\">#</a> 什么时候使用 reject ()</h3>\n<p>说清楚这个问题之前，先说一下 W1 里面说的三个状态，pengding  执行中，fulfilled 已成功，rejected  已失败，执行中基本上不用关注，我们通过执行下面代码</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">dir</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>然后浏览器 F12 查看打印结果可以发现 Promise 是这样的，这个 Promise 对象的状态 PromiseState 是 pengding</p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/20220528211529.png\" alt=\"\" /></p>\n<p>然后我们通过在方法体调用 resolve ()</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">dir</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>发现此时 PromiseState 的状态已经改成 fulfilled；</p>\n<p>如果调用 reject ()</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">dir</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>发现 PromiseState 已经改成为 rejected，这就是 Promise 的三种状态和两种改变状态的方法，那么既然 resolve 表示正常的时候执行，并且可以把执行结果传入到下一次异步调用进行使用，那么 reject 方法能传值吗？传的值去哪里了？怎么接收？</p>\n<p>答案三连：</p>\n<ul>\n<li>能传值</li>\n<li>reject 代表执行过程出现错误了，自然是给接收错误的地方</li>\n<li>通过 catch () 方法接收</li>\n</ul>\n<p>同样我们通过上面的例子，假如 <code>user.json</code>  由于服务器或者网络原因不能被调用了，我们需要在 ajax 的方法加上一个出现错误的处理情况</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> params<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span>reject</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 用了 jQuery 的 ajax 方法，调试的话请先引入 jQuery</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        $<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> url<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token literal-property property\">params</span><span class=\"token operator\">:</span>params<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token function-variable function\">error</span><span class=\"token operator\">:</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// 这里加上执行错误的处理</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"调用超时或者服务器错误\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token string\">'user1.json'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 直接把调用改成不存在的 user1.json</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">userInfo</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span>userId<span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> userInfo<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"用户ID:  \"</span><span class=\"token operator\">+</span>userId<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token string\">'role.json'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">userId</span><span class=\"token operator\">:</span>userId<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">roleData</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>roleData<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"接收的错误消息： \"</span> <span class=\"token operator\">+</span> msg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>通过上面的代码，我们发现 reject 传入的消息通过 catch 方法接收了，这就是三大方法中的 then 方法和 catch 方法了，剩下一个 finally () 意思就是无论执行过程中是否正常执行，都会执行里面的代码，和 java 的 finally 代码意思一致，这里需要说明的是<strong> catch 方法，除了能捕获 reject () 调用改变 Promise 状态的结果之外，还能能捕获上面所有执行的异步代码块的问题</strong>，如果前面的异步方法执行发生错误，后面的 then () 不会被执行。</p>\n<h2 id=\"三-async和await的使用\"><a class=\"anchor\" href=\"#三-async和await的使用\">#</a> 三、async 和 await 的使用</h2>\n<p>简单说这两个关键字是基于 Promise 之上的语法糖，它们能使得对异步的操作更加简洁明了</p>\n<h3 id=\"async和await的基本使用\"><a class=\"anchor\" href=\"#async和await的基本使用\">#</a> async 和 await 的基本使用</h3>\n<p>我们可以对方法名进行 async 修饰，标记这个方法为异步方法， 意思就是这个行数返回的值是 Promise 对象</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">myFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">\"async function result\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">myFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>比如上面的代码的打印结果就是一个 Promise 结果为 <code>&quot;async function result&quot;</code>  这个字符串，状态 <code>fulfilled</code>  的 Promise 对象；</p>\n<p>如果我们要在这个方法里面对异步方法结果进行操作，则可以通过下面的方式使用异步方法执行之后的结果，这个例子我们使用上面的 getData 方法</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">myFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">let</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"await请求结果： \"</span><span class=\"token operator\">+</span>res<span class=\"token punctuation\">.</span>userId<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">myFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"后面执行的代码\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><code>题外：上面方法没有返回结果，想想打印出来的结果是什么？</code> 😃</p>\n<p>这里虽然加上了 await，代码看上去也非常像是同步的代码，会暂停程序的往下执行，但在等待的过程中 javascript 还可以同时处理其他的任务，比如界面的更新，执行其他的程序代码等，如上面代码中最后一行的打印会在 async 方法打印之前打印出来</p>\n<h3 id=\"await使用陷阱\"><a class=\"anchor\" href=\"#await使用陷阱\">#</a> await 使用陷阱</h3>\n<ul>\n<li>\n<h4 id=\"为保证效率可以组合使用之后再用await方法比如\"><a class=\"anchor\" href=\"#为保证效率可以组合使用之后再用await方法比如\">#</a> 为保证效率，可以组合使用之后再用 await 方法，比如</h4>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">myFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">let</span> user1 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user1.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">let</span> user2 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user2.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 下面省略对 res1 和 res2 的操作</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">//.....</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>可以使用以下方式</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">myFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">let</span> res1 <span class=\"token operator\">=</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user1.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">let</span> res2 <span class=\"token operator\">=</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user2.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span>user1<span class=\"token punctuation\">,</span>user2<span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Promist<span class=\"token punctuation\">.</span><span class=\"token function\">promiseAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>res1<span class=\"token punctuation\">,</span>res2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// 下面省略对 res1 和 res2 的操作</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">//.....</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>效率理论上能提升一倍</p>\n<ul>\n<li>\n<h4 id=\"循环中使用异步操作不能调用foreachmap\"><a class=\"anchor\" href=\"#循环中使用异步操作不能调用foreachmap\">#</a> 循环中使用异步操作，不能调用 forEach ()/map ()</h4>\n</li>\n</ul>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>arr<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">element</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">&#123;</span>userId<span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user.json\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>element <span class=\"token operator\">+</span> <span class=\"token string\">\" - \"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"the end\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>如上第二行代码不会等到所有代码执行完毕再执行，而是马上执行后面的 <code>&quot;the end&quot;</code>  输出，尽管使用了 await 进行修饰，可以使用传统的 for 循环来达到我们先要的效果</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">myFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token number\">4</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">let</span> <span class=\"token punctuation\">&#123;</span>userId<span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user.json\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token string\">\" - \"</span> <span class=\"token operator\">+</span> userId<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"the end\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">myFunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ul>\n<li>\n<h4 id=\"不能在全局和普通函数中使用await必须在async修饰的函数体里面使用\"><a class=\"anchor\" href=\"#不能在全局和普通函数中使用await必须在async修饰的函数体里面使用\">#</a> 不能在全局和普通函数中使用 await，必须在 async 修饰的函数体里面使用</h4>\n</li>\n</ul>\n<p>不在 async 函数体里面会报错😒</p>\n",
            "tags": [
                "前端",
                "基础知识",
                "javascript"
            ]
        },
        {
            "id": "https://blog.liq2.com/article/7654e55b",
            "url": "https://blog.liq2.com/article/7654e55b",
            "title": "各个管理端框架比较参考",
            "date_published": "2022-05-25T00:32:01.000Z",
            "content_html": "<p>市面上越来越多的好看的管理端框架，真是可谓眼花缭乱，对于做主要做后端的人来说，真是个好事情，拿下代码来稍作学习便可以开发管理系统了！本文就分享一些体验过的框架。</p>\n<p>感觉目前 UI 框架整体分三类</p>\n<ul>\n<li>注重视觉和生态的，比如 ant-design, acro-design 等；</li>\n<li>注重组件开发的，如 element-ui, vant, naive-ui 等；</li>\n<li>注重开箱即用的，这种方式基本上是在上面的两种框架的基础上，自己通过整合路由、权限和一些常用实现，同时对性能和美观方面进行优化的前端框架，比如 antd-admin, naive-ui-admin,  vue-admin-better 等；</li>\n</ul>\n<h2 id=\"naive-ui\"><a class=\"anchor\" href=\"#naive-ui\">#</a> naive-ui</h2>\n<p>这个目前兴趣比较大的一个框架，因为感觉跟现在的项目要求比较契合，界面也基本 OK</p>\n<p>官网 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubmFpdmV1aS5jb20v\">点这里</span></p>\n<p>文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubmFpdmV1aS5jb20vemgtQ04vb3MtdGhlbWUvZG9jcy9pbnRyb2R1Y3Rpb24=\">Naive UI - Naive UI</span></p>\n<p>组件说明：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubmFpdmV1aS5jb20vemgtQ04vb3MtdGhlbWUvY29tcG9uZW50cy9idXR0b24=\"> Naive UI</span></p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/20220525093636.png\" alt=\"\" /></p>\n<h3 id=\"soybean-admin\"><a class=\"anchor\" href=\"#soybean-admin\">#</a> soybean-admin</h3>\n<p>项目地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hvbmdodWFuZ2RjL3NveWJlYW4tYWRtaW4=\">基于 Vite + Vue3 + NaiveUI + TypeScript 的漂亮清新的中后台管理模版 </span></p>\n<p>预览地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zb3liZWFuLnByby8=\">点我预览</span></p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/20220525093923.png\" alt=\"\" /></p>\n<h3 id=\"naive-ui-admin\"><a class=\"anchor\" href=\"#naive-ui-admin\">#</a> naive-ui-admin</h3>\n<p>项目地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2pla2lwL25haXZlLXVpLWFkbWlu\">Naive Ui Admin 基于 vue3,vite2,TypeScript 的中后台解决方案 </span></p>\n<p>预览地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9uYWl2ZS11aS1hZG1pbi52ZXJjZWwuYXBw\">点我预览</span></p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/20220525094131.png\" alt=\"\" /></p>\n<p>这个还支持其他几个版本，貌似除了 v1 版本之外收费，naive 版本的 v2 个人觉得界面还可以，但是价钱对比没有什么优势</p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/20220525094837.png\" alt=\"\" /></p>\n<h3 id=\"admin-work\"><a class=\"anchor\" href=\"#admin-work\">#</a> admin-work</h3>\n<p>项目地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3FpbmdxaW5neHVhbi9hZG1pbi13b3Jr\">一款免费开源、功能强大、方便易用、漂亮的中后台管理系统模板</span></p>\n<p>预览地址：<span class=\"exturl\" data-url=\"aHR0cDovL2F3LnZ1ZWFkbWlud29yay5jb20v\">点我预览</span></p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/20220525100846.png\" alt=\"\" /></p>\n<p>​\t虽然也有收费版，但是我居然觉得免费版要比收费的要好看 😂</p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/20220525101100.png\" alt=\"\" /></p>\n<h2 id=\"ant-design\"><a class=\"anchor\" href=\"#ant-design\">#</a> ant-design</h2>\n<p>这个目前官方只有 React 版本，Vue 版本由个人开发维护</p>\n<p>官方网址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbnQuZGVzaWduL2luZGV4LWNu\">Ant Design - 一套企业级 UI 设计语言和 React 组件库</span></p>\n<h3 id=\"ant-design-pro\"><a class=\"anchor\" href=\"#ant-design-pro\">#</a> ant-design-pro</h3>\n<p>项目地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FudC1kZXNpZ24vYW50LWRlc2lnbi1wcm8=\">Use Ant Design like a Pro</span></p>\n<p>预览地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wcmV2aWV3LnByby5hbnQuZGVzaWdu\">点我预览</span></p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/20220525103829.png\" alt=\"\" /></p>\n<h3 id=\"antd-admin\"><a class=\"anchor\" href=\"#antd-admin\">#</a> antd-admin</h3>\n<p>项目地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3p1aWlkZWEvYW50ZC1hZG1pbg==\">zuiidea/antd-admin: An excellent front-end solution for enterprise applications built upon Ant Design and UmiJS (github.com)</span></p>\n<p>预览地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hbnRkLWFkbWluLnp1aWlkZWEuY29tLw==\">点我预览</span></p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/20220525113134.png\" alt=\"\" /></p>\n<h2 id=\"acro-design\"><a class=\"anchor\" href=\"#acro-design\">#</a> acro-design</h2>\n<p>这个是字节跳动最近两年才开源出来的视觉设计和生态框架，和 semi 同属一家公司还几乎同时开源 😂, 居然还同时被指抄袭 antd, 它有 React 和 Vue 两个版本，官方提供 arco-pro 基础开发框架</p>\n<p>官网： <span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcmNvLmRlc2lnbi8=\">Arco Design - 企业级产品的完整设计和开发解决方案</span></p>\n<h3 id=\"arco-design-pro-vue\"><a class=\"anchor\" href=\"#arco-design-pro-vue\">#</a> arco-design-pro-vue</h3>\n<p>官方提供的框架</p>\n<p>项目地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FyY28tZGVzaWduL2FyY28tZGVzaWduLXByby12dWU=\">An out-of-the-box solution to quickly build enterprise-level applications based on Arco Design</span></p>\n<p>预览地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly92dWUtcHJvLmFyY28uZGVzaWduLw==\">点我预览</span></p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/image-20220525115320506.png\" alt=\"\" /></p>\n",
            "tags": [
                "前端",
                "工具",
                "UI框架"
            ]
        },
        {
            "id": "https://blog.liq2.com/article/768b74a2",
            "url": "https://blog.liq2.com/article/768b74a2",
            "title": "jsDelivr静态文件CDN加速失效之后解决方案和PicGo图床基本使用",
            "date_published": "2022-05-20T08:33:30.000Z",
            "content_html": "<p>屁颠屁颠用 gihub+jsDelivr 加速做 js 文件 cdn 加速和图床之后，发现国内网络访问打开不到图片，原来 jsDelivr 在去年年底不能访问了，官方声明 Unfortunately today jsDelivr unexpectedly lost its ICP license in China.<br />\n<img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/vyUEcWz3Hfsx6oZ.png\" alt=\"\" /></p>\n<p>虽然说看起来是给创建博客的个人和小企业来说是个坏事，但是对于整个国家宏观来说却也可以理解，国人必须要自己能拥有网络内容主动权嘛，话说现在形势还这么紧张不是；</p>\n<h2 id=\"全局url替代\"><a class=\"anchor\" href=\"#全局url替代\">#</a> 全局 URL 替代</h2>\n<ul>\n<li>\n<p>如果使用的是 npm 库，可以使用 unpkg.com 替换</p>\n<p>eg:  <code>https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js</code> ，替换为 <code>https://unpkg.com/pace-js@1.0.2/pace.min.js</code></p>\n</li>\n<li>\n<p>上面方式慢，可以使用中国镜像 <span class=\"exturl\" data-url=\"aHR0cDovL3VucGtnLnpoaW1nLmNvbQ==\">unpkg.zhimg.com</span></p>\n<p>eg:  <code>https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js</code> ，替换为 <code>https://unpkg.zhimg.com/pace-js@1.0.2/pace.min.js</code>  但是<strong>这种方式并不是对所有的连接都有效</strong>，比如： <code>https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js</code>  被替换之后还是访问不到。</p>\n</li>\n</ul>\n<p>综上，如果是在开发工具里，可以全局搜索 <code>cdn.jsdelivr.net/npm</code>  替换为 <code>unpkg.com</code>  或者 <code>unpkg.zhimg.com</code> ，但是仅限 npm 库，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1jZG4teGk5ZGs3MmQuanNkZWxpdnIubmV0L2NvbWJpbmUlRTUlOEElOUYlRTglODMlQkQlRTUlOEQlQjQlRTUlQjklQjYlRTQlQjglOEQlRTglQjUlQjclRTQlQkQlOUMlRTclOTQlQTg=\">对于 cdn.jsdelivr.net/combine 功能却并不起作用</span> 😒 ；</p>\n<h3 id=\"新的项目使用其他国内支持的\"><a class=\"anchor\" href=\"#新的项目使用其他国内支持的\">#</a> 新的项目使用其他国内支持的</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZG5qcy5jb20v\">https://cdnjs.com/</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudW5wa2cuY29tLw==\">https://www.unpkg.com/</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYm9vdGNkbi5jbi8=\">https://www.bootcdn.cn/</span></li>\n</ul>\n<h3 id=\"自己搭建服务器或者购买\"><a class=\"anchor\" href=\"#自己搭建服务器或者购买\">#</a> 自己搭建服务器或者购买</h3>\n<ul>\n<li>\n<p>自己搭建</p>\n<p>对于图床服务器可以考虑自己搭建图床服务器 [一个易于搭建的图床服务器](<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1JlZG5zL0ltYWdlQmVk\">Redns/ImageBed: 一个易于搭建的图床服务 (github.com)</span>)</p>\n<p>搭建 minIO 服务器，暂时不知道是否支持 js 文件 ❓</p>\n</li>\n<li>\n<p>购买收费服务</p>\n<p>比如购买某里，某迅的 CDN 加速，天下没有免费的午餐，交点钱买个安心；</p>\n</li>\n</ul>\n<p>-------------------------------2022-06-06 - 更新分割线 start-------------------------------</p>\n<h3 id=\"使用临时可用的连接地址\"><a class=\"anchor\" href=\"#使用临时可用的连接地址\">#</a> 使用临时可用的连接地址</h3>\n<p>根据 github 上面的 jsdelivr 项目的 issue 提示， 居然有可以用的的域名<br />\n<img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/20220609141107.png\" alt=\"\" /><br />\n如上图所示，我们可以根据上面的域名，进行对使用的项目进行由 <code>cdn.jsdelivr.net</code>  到 <code>fastly.jsdelivr.net</code>  全局替换， 这个方法应该适用于 hexo 的 shoka 主题国内不可用问题</p>\n<p>-------------------------------2022-06-06 - 更新分割线 end-------------------------------</p>\n<h2 id=\"picgo图床的基本使用\"><a class=\"anchor\" href=\"#picgo图床的基本使用\">#</a> PicGo 图床的基本使用</h2>\n<h3 id=\"软件下载和安装\"><a class=\"anchor\" href=\"#软件下载和安装\">#</a> 软件下载和安装</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL01vbHVuZXJmaW5uL1BpY0dv\">PicGo</span> 是一个 github 上开源项目，发布的版本可以点<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL01vbHVuZXJmaW5uL1BpY0dvL3JlbGVhc2Vz\">这里</span>下载，写文章的时候的最新稳定版本是 2.3.0，安装成功后如图；</p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts//blog/article-files/2022/05/20220521094526.png\" alt=\"\" /></p>\n<h3 id=\"插件安装\"><a class=\"anchor\" href=\"#插件安装\">#</a> 插件安装</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3huLS1zbS1wdjJjbzU0Y2Z6aXdpZDFyZWJ1NGF6d2lldDFjZHZncTUxYnVqdS5tcw==\">上面安装的版本默认支持 sm.ms</span>, 腾讯云 cos，又拍云，github，阿里云 oss 等， 但是想要支持 gitee 和其他如 imgtp 上传的话需要点击插件设置安装插件之后才能使用，</p>\n<p>点击插件设置可以进行关键字搜索进行安装，有时候不知道有哪些插件可用，所以我更喜欢点上面的购物袋进行插件列表查看，或者点<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1BpY0dvL0F3ZXNvbWUtUGljR28=\">这里</span>直接传送；然后看看哪些图床可以使用。</p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts//blog/article-files/2022/05/20220521095325.png\" alt=\"\" /></p>\n<h3 id=\"账号配置\"><a class=\"anchor\" href=\"#账号配置\">#</a> 账号配置</h3>\n<p>根据各个平台要求，结合各个插件使用进行配置，就能完成图床的配置；</p>\n<p>说下我选择图床的考虑因素：</p>\n<ol>\n<li>\n<p>要有内容自主权</p>\n<p>现在免费的和付费的图床这么多，自然是要考虑要一个自己控制内容的，我作为写博客使用的图床，一般都是会根据时间进行放置，所以必要能按照我希望的格式和目录去放置，大致看了下除了七牛，腾讯云 COS，阿里云 OSS，github 这些大厂提供的服务可以存放到指定的目录，但是都是有容量限制要不就是要米🔓</p>\n</li>\n<li>\n<p>备份功能和图床切换方便</p>\n<p>万一你使用的图床挂了呢，必须是要能整个图床内容图片整体备份出来，按照一定的格式切换到另外一个图床继续浪里个浪啊；</p>\n</li>\n</ol>\n<h3 id=\"文件上传和链接获取\"><a class=\"anchor\" href=\"#文件上传和链接获取\">#</a> 文件上传和链接获取</h3>\n<p>上传和链接获取这个应该是用过电脑一年以上的人应该都是了的，应该不用多说了，直接上传剪贴板的图片功能也支持微信等一些工具的截图，💃真是非常的 nice 啊！</p>\n",
            "tags": [
                "前端",
                "工具",
                "jsDelivr",
                "PicGo图床"
            ]
        },
        {
            "id": "https://blog.liq2.com/article/ffae4388",
            "url": "https://blog.liq2.com/article/ffae4388",
            "title": "用jsDelivr和Github做免费的CDN加速",
            "date_published": "2022-05-16T04:13:50.000Z",
            "content_html": "<h2 id=\"cdn解释\"><a class=\"anchor\" href=\"#cdn解释\">#</a> CDN 解释</h2>\n<p>CDN 是内容分发网络（Content Delivery Network）的首字母简写，是指一组分布在不同地理位置的服务器，协同工作以提供互联网内容的快速交付。</p>\n<p>CDN 允许快速传输加载互联网内容所需的资源，包括 HTML 页面、javascript 文件、样式表、图像和视频。 CDN 服务已得到不断普及。如今，大多数 web 流量都通过 CDN 提供服务，包括来自 Facebook、Netflix 和亚马逊等主要网站的流量。</p>\n<p>正确配置的 CDN 还可帮助保护网站免受某些常见的恶意攻击，例如分布式拒绝服务（DDOS）攻击。</p>\n<h3 id=\"为什么使用cdn\"><a class=\"anchor\" href=\"#为什么使用cdn\">#</a> 为什么使用 CDN</h3>\n<ul>\n<li>缩短网站加载时间 – 通过将内容分发到访问者附近的 CDN 服务器（以及其他优化措施），访问者体验到更快的页面加载时间。由于访问者更倾向于离开加载缓慢的网站，CDN 可以降低跳出率并增加人们在该网站上停留的时间。换句话说，网站速度越快，用户停留的时间越长。</li>\n<li>减少带宽成本 – 网站托管的带宽消耗成本是网站的主要费用。通过缓存和其他优化，CDN 能够减少源服务器必须提供的数据量，从而降低网站所有者的托管成本。</li>\n<li>增加内容可用性和冗余 – 大流量或硬件故障可能会扰乱正常的网站功能。由于 CDN 具有分布式特性，因此与许多源服务器相比，CDN 可以处理更多流量并更好地承受硬件故障。<br />\n改善网站安全性 – CDN 可以通过提供 DDoS 缓解、安全证书的改进以及其他优化措施来提高安全性。</li>\n</ul>\n<h2 id=\"创建过程\"><a class=\"anchor\" href=\"#创建过程\">#</a> 创建过程</h2>\n<h3 id=\"创建github静态文件存放项目比如\"><a class=\"anchor\" href=\"#创建github静态文件存放项目比如\">#</a> 创建 github 静态文件存放项目，比如：</h3>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/image-20220516145102758.png\" alt=\"创建项目\" /></p>\n<h3 id=\"提交静态文件到1创建项目\"><a class=\"anchor\" href=\"#提交静态文件到1创建项目\">#</a> 提交静态文件到 #1 创建项目</h3>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/image-20220516145102754.png\" alt=\"提交文件\" /></p>\n<h3 id=\"获取转换文件\"><a class=\"anchor\" href=\"#获取转换文件\">#</a> 获取转换文件</h3>\n<p>复制文件地址到 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuanNkZWxpdnIuY29tL2dpdGh1Yg==\">https://www.jsdelivr.com/github</span> 进行地址转换， 点击 copy 获取 cdn 连接</p>\n<p>其实这里的路径规则就是 按照</p>\n<p><code>https://cdn.jsdelivr.net/gh/你的用户名/你的仓库名@发布的版本号/文件路径</code></p>\n<p>知道这个规则之后你可以自行修改路径了  🤞</p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/image-20220516161211430.png\" alt=\"image-20220516161211430\" /></p>\n<h3 id=\"引用\"><a class=\"anchor\" href=\"#引用\">#</a> 引用</h3>\n<p>在 html 或者 markdown 文件里面引用 URL  💃</p>\n",
            "tags": [
                "前端",
                "工具",
                "jsDelivr",
                "CDN加速"
            ]
        },
        {
            "id": "https://blog.liq2.com/article/7d501b47",
            "url": "https://blog.liq2.com/article/7d501b47",
            "title": "Hexo的aomori主题使用Remark42搭建文章评论功能",
            "date_published": "2022-05-15T05:32:25.000Z",
            "content_html": "<p>开始求生欲望极强的声明一下，本人刚刚开始玩 Hexo 几天，所以都是以我现在的水平表述操作过程，说得不对还请多多指正。</p>\n<h2 id=\"环境说明\"><a class=\"anchor\" href=\"#环境说明\">#</a> 环境说明</h2>\n<ol>\n<li>Hexo 6.2.0</li>\n<li>主题 Aomori 1.35.0</li>\n<li>Remark42 1.9.0</li>\n<li>Remark42 部署服务器环境 wind10 操作系统</li>\n<li>nginx 1.21.6</li>\n<li>部署环境，Github Pages</li>\n</ol>\n<h2 id=\"操作过程\"><a class=\"anchor\" href=\"#操作过程\">#</a> 操作过程</h2>\n<h3 id=\"配置自己的remark42服务器\"><a class=\"anchor\" href=\"#配置自己的remark42服务器\">#</a> <strong>配置自己的 remark42 服务器</strong></h3>\n<p>官方提供两中配置方式，docker 部署和二进制安装部署，本文使用 windwos 环境下的 zip 文件进行安装<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3VtcHV0dW4vcmVtYXJrNDIvcmVsZWFzZXMvZG93bmxvYWQvdjEuOS4wL3JlbWFyazQyLndpbmRvd3MtYW1kNjQuemlw\">点这里下载 Remark42-1.9.0</span></p>\n<p>下载后直接解压，文件结构也很简单</p>\n<figure class=\"highlight raw\"><figcaption data-lang=\"\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>.</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>+-- _config.yml</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>+-- var</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>|   +-- avanta</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>|   +-- backups</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>+-- remark42.windows-amd64.exe</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>+-- README.md</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>+-- LICENSE</pre></td></tr></table></figure><p>参考官方文档的例子  cmd 到文件夹之后  直接用 remark42.windows-amd64.exe 后面带配置参数就可以跑起来， <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yZW1hcms0Mi5jb20vZG9jcy9nZXR0aW5nLXN0YXJ0ZWQvaW5zdGFsbGF0aW9uLw==\">官方文档说明</span></p>\n<p>比如使用官方的启动例子就能运行起来：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ remark42.linux-amd64 server --secret<span class=\"token operator\">=</span><span class=\"token number\">12345</span> --url<span class=\"token operator\">=</span>http://127.0.0.1:8080</pre></td></tr></table></figure><p>运行之后你浏览器打开 <span class=\"exturl\" data-url=\"aHR0cDovLzEyNy4wLjAuMTo4MDgwL3dlYg==\">http://127.0.0.1:8080/web</span>, 能够看到一个如下的页面，说明你已经跑起来 😄</p>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/image-20220515185339060.png\" alt=\"\" /></p>\n<p>参考启动参数，结合自身项目情况，我整理了几个可能你和我一样也可能用到的一个一个启动命令：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>remark42.windows-amd64.exe server --secret<span class=\"token operator\">=</span>not4you2know --url<span class=\"token operator\">=</span>https://sub.yourdomain.com --auth.github.cid<span class=\"token operator\">=</span><span class=\"token number\">1107</span>********9011b --auth.github.csec<span class=\"token operator\">=</span>a7665**********05741 --auth.anon --site<span class=\"token operator\">=</span>mySiteId</pre></td></tr></table></figure><p>其中各个参数说明：</p>\n<ul>\n<li>\n<p>--secret 必须参数，官方说明是 secret key, can be any long and hard-to-guess string 具体是起什么作用？没有弄明白，又知道的请留言帮我解惑🤝</p>\n</li>\n<li>\n<p>--url Remark42 服务器的 URL 必须的参数， 这个也不知道起什么作用，我测试是设置内网 http://127.0.0.1:8080 地址，然后用 nginx 映射道外网域名使用自己的域名也没有发现问题</p>\n</li>\n<li>\n<p>--auth 开头的参数，用于配置评论的身份认证，需要开通第三方的登陆认证权限，本例子直配置了 github 登陆认证权限，获取第三方应用分配的 clientId 和 clientScret 分别对应 --auth.github.cid 和 auth.github.csec 两个值</p>\n</li>\n<li>\n<p>--auth.anon 是否允许匿名评论 (匿名评论也需要随便填入一个昵称)，只有 key 没有值，加上为 true, 去掉就是 false</p>\n</li>\n<li>\n<p>--site 这个参数默认是 remark, 必须和前端的配置一致，不一致可能导致之前评论会丢失</p>\n<p>其他配置说明请参考官方说明 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9yZW1hcms0Mi5jb20vZG9jcy9jb25maWd1cmF0aW9uL3BhcmFtZXRlcnMv\">Remark42 服务器配置说明</span></p>\n</li>\n</ul>\n<h3 id=\"配置外网映射\"><a class=\"anchor\" href=\"#配置外网映射\">#</a> <strong>配置外网映射</strong></h3>\n<p>由于博客放到外网，所以需要把 Remark42 进行外网映射，具体配置方式这里不做说明，需要注意的两个地方：</p>\n<ul>\n<li>因为 GitHub pages 和 GitLab pages 都是默认使用 SSL 协议的 https 进行访问，所以映射需要同样的使用 SSL 部署 Remark42</li>\n<li>考虑前端的访问跨域问题 (后面验证好像 Remark42 默认支持跨域访问，但是为了保险最好也不要忽略)</li>\n</ul>\n<h3 id=\"配置hexo的_configyml文件\"><a class=\"anchor\" href=\"#配置hexo的_configyml文件\">#</a> <strong>配置 Hexo 的_config.yml 文件</strong></h3>\n<p>Hexo 的根目录 _config.yml, 添加如下配置：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">aomori_remark42</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">enable</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\"># 如果要放到 github pages，需要把第 #1 步映射到外网</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'https://sub.yourdomain.com'</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">site_id</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'mySiteId'</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\"># 最多显示评论数量</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">max_shown_comments</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">theme</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"light\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token comment\"># 用中文显示评论框</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">locale</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"zh\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token comment\"># 一些组件配置 embed 基本评论小部件 last-comments 最后评论小部件</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">components</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'embeded'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'last-comments'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token comment\"># 是否显示邮件订阅</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">show_email_subscription</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr></table></figure><p>按照上面的配置做好了之后，基本上就可以用了，其中各个参数的含义如官方说明 (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9yZW1hcms0Mi5jb20vZG9jcy9jb25maWd1cmF0aW9uL2Zyb250ZW5kLw==\">Remark42 前端配置</span>)：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> string (required) – hostname of Remark42 server<span class=\"token punctuation\">,</span> same as REMARK_URL in backend config<span class=\"token punctuation\">,</span> e.g. \"https<span class=\"token punctuation\">:</span>//demo.remark42.com\"</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">site_id</span><span class=\"token punctuation\">:</span> string (optional<span class=\"token punctuation\">,</span> remark by default) – the SITE that you passed to Remark42 instance on start of backend.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> string (optional<span class=\"token punctuation\">,</span> window.location.origin + window.location.pathname by default) – url to the page with comments<span class=\"token punctuation\">,</span> it is used as unique identificator for comments thread</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Note that if you use query parameters as significant part of URL (the one that actually changes content on page) you will have to configure URL manually to keep query params<span class=\"token punctuation\">,</span> as window.location.origin + window.location.pathname doesn't contain query params and hash. For example<span class=\"token punctuation\">,</span> default URL for https<span class=\"token punctuation\">:</span>//example/com/example<span class=\"token punctuation\">-</span>post<span class=\"token punctuation\">?</span>id=1<span class=\"token comment\">#hash would be https://example/com/example-post</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">components</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>'embed' <span class=\"token punctuation\">|</span> 'last<span class=\"token punctuation\">-</span>comments' <span class=\"token punctuation\">|</span> 'counter'<span class=\"token punctuation\">]</span> (optional<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'embed'</span><span class=\"token punctuation\">]</span> by default) – an array of widgets that should be rendered on a page. You may use more than one widget on a page.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key atrule\">Available components are</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>'embed' – basic comments widget</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>'last<span class=\"token punctuation\">-</span>comments' – last comments widget<span class=\"token punctuation\">,</span> see Last Comments section below</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>'counter' – counter widget<span class=\"token punctuation\">,</span> see Counter section below</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key atrule\">max_shown_comments</span><span class=\"token punctuation\">:</span> number (optional<span class=\"token punctuation\">,</span> 15 by default) – maximum number of comments that is renered on mobile version</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key atrule\">theme</span><span class=\"token punctuation\">:</span> 'light' <span class=\"token punctuation\">|</span> 'dark' (optional<span class=\"token punctuation\">,</span> 'light' by default) – changes UI theme</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token key atrule\">page_title</span><span class=\"token punctuation\">:</span> string (optional<span class=\"token punctuation\">,</span> document.title by default) – title for current comments page</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token key atrule\">locale</span><span class=\"token punctuation\">:</span> enum (optional<span class=\"token punctuation\">,</span> 'en' by default) – interface localization<span class=\"token punctuation\">,</span> check possible localizations</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token key atrule\">show_email_subscription</span><span class=\"token punctuation\">:</span> boolean (optional<span class=\"token punctuation\">,</span> true by default) – enables email subscription feature in interface when enable it from backend side<span class=\"token punctuation\">,</span> if you set this param in false you will get notifications email notifications as admin but your users won't have interface for subscription</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token key atrule\">simple_view</span><span class=\"token punctuation\">:</span> boolean (optional<span class=\"token punctuation\">,</span> false by default) – overrides the parameter from the backend minimized UI with basic info only</pre></td></tr></table></figure><h2 id=\"遇到的问题\"><a class=\"anchor\" href=\"#遇到的问题\">#</a> 遇到的问题</h2>\n<h3 id=\"配置remark42需要ssl证书\"><a class=\"anchor\" href=\"#配置remark42需要ssl证书\">#</a> 配置 Remark42 需要 SSL 证书</h3>\n<p>可以去阿里云官网去申请免费的 ssl 证书，然后在适当的位置配置上就可以</p>\n<h3 id=\"remrk客户端显示不了登陆选项\"><a class=\"anchor\" href=\"#remrk客户端显示不了登陆选项\">#</a> Remrk 客户端显示不了登陆选项</h3>\n<p>Remark42 默认没有配置任何登陆选项，请至少打开 --scret.anno 以支持匿名评论，其他的认证方式情参考官网说明<span class=\"exturl\" data-url=\"aHR0cHM6Ly9yZW1hcms0Mi5jb20vZG9jcy9jb25maWd1cmF0aW9uL2F1dGhvcml6YXRpb24v\"> Remark42 认证权限说明</span></p>\n",
            "tags": [
                "前端",
                "工具",
                "Hexo",
                "Hexo",
                "工具使用"
            ]
        },
        {
            "id": "https://blog.liq2.com/article/3aeffd05",
            "url": "https://blog.liq2.com/article/3aeffd05",
            "title": "Alpine和eleventy搭配的基本使用",
            "date_published": "2022-05-13T07:31:26.000Z",
            "content_html": "<p>同理，先占位， 后面会更新</p>\n",
            "tags": [
                "前端",
                "开发框架",
                "工具",
                "Alpine",
                "11ty",
                "eleventy"
            ]
        },
        {
            "id": "https://blog.liq2.com/article/955aeda8",
            "url": "https://blog.liq2.com/article/955aeda8",
            "title": "JAVA多线程总结之一",
            "date_published": "2022-05-13T05:49:45.000Z",
            "content_html": "<p>这里还没有任何内容，先占个位！</p>\n",
            "tags": [
                "后端",
                "Java",
                "多线程",
                "线程池",
                "JUC"
            ]
        },
        {
            "id": "https://blog.liq2.com/article/52cf48bf",
            "url": "https://blog.liq2.com/article/52cf48bf",
            "title": "开通博客第一天",
            "date_published": "2022-05-12T13:02:40.000Z",
            "content_html": "<p>喜大普奔，终于搞定一个低成本的放博客的地方，并且实实在在的跑了起来！</p>\n<h2 id=\"博客目的\"><a class=\"anchor\" href=\"#博客目的\">#</a> 博客目的</h2>\n<ol>\n<li>记录各种操作的过程，便于以后查阅；</li>\n<li>锻炼写作，提升自己思路整理能力；</li>\n<li>各种分享；</li>\n<li>看看自己能不能坚持做一件事，我想如果我坚持，然后不时翻一翻，应该还是有好处。</li>\n</ol>\n<p><img data-src=\"https://fastly.jsdelivr.net/gh/crabeye/site-asserts/blog/article-files/2022/05/cover_20220512.jfif\" alt=\"happy\" /></p>\n<h2 id=\"加油\"><a class=\"anchor\" href=\"#加油\">#</a> 加油！</h2>\n",
            "tags": [
                "感悟",
                "心情",
                "心情记录",
                "胡言乱语"
            ]
        }
    ]
}